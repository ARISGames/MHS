<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="no-cache" />
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<meta name="viewport" content="width=device-width; initial-scale=1.0 maximum-scale=1.0 user-scalable=no;"/>
<meta name="apple-mobile-web-app-capable" content="yes" />
<title>Trading Post</title>
<link href="style.css" rel="stylesheet" type="text/css"></link>
<script type="text/javascript" src="utils/json2.js"></script>
<script type="text/javascript" src="model.js"></script>
<script type="text/javascript" src="views.js"></script>
<script type="text/javascript">

var ARIS = {};
var readyCount = 2;
function partReady()
{
    readyCount--;
    if(readyCount == 0) begin();
}
ARIS.ready = function() { partReady(); };

function begin()
{
    initViews();
    setTimeout(loadStateFromARIS,100);//calls "stateReceived()" when done
}

var firstTime = false;
function stateReceived()
{
    ARIS.didUpdateItemQty = function(updatedItemId,qty) {};//silence updates while we get things ready
    if(!currentRole) { firstTime = true; getNextRole(); }
    else roleWasSet();
}

function roleWasSet()//role was dynamically assigned- proceed
{
    //Handle in-game updates
    ARIS.didUpdateItemQty = function(updatedItemId,qty)
    {
        //Handle visuals based on role and level
        if(currentRole.roleEnum == roleEnumClerk)
        {
            switch(currentLevel)
            {
                case 1:
                    if(updatedItemId == itemPelt.itemId)
                    {
                        haveDisplay.innerHTML = "Pelts: "+qty;
                        if(qty != itemPelt.qty)
                        {
                            if(Math.abs(qty-itemPelt.qty) == 1) displaydelta(qty-itemPelt.qty, "pelt");
                            else displaydelta(qty-itemPelt.qty, "pelts");
                        }
                    }
                    break;
                case 2:
                    break;
            }
        }
        else if(currentRole.roleEnum == roleEnumHunter)
        {
            switch(currentLevel)
            {
                case 1:
                    if(updatedItemId == itemPelt.itemId)
                    {
                        haveDisplay.innerHTML = "Pelts: "+qty;
                        if(qty != itemPelt.qty)
                        {
                            if(Math.abs(qty-itemPelt.qty) == 1) displaydelta(qty-itemPelt.qty, "pelt");
                            else displaydelta(qty-itemPelt.qty, "pelts");
                        }
                    }
                    break;
                case 2:
                    break;
            }
        }

        if(o = itemForItemId(updatedItemId))
            setItemQtyInInventory(o.itemEnum, qty);

        if(hasAllNeededItems())
        {
            ARIS.setItemCount(levelIdForLevel(currentLevel),1);
            currentLevel++;
        }
    }

    displayRole(currentRole.roleEnum);
    if(firstTime) displayVid();
    else
    {
        switch(currentLevel)
        {
            case 1:
                displayGet();
                break;
            case 2:
                displayTrade();
                break;
        }
    }
}

window.addEventListener('load', partReady, false);
window.onerror = function(msg, url, linenumber) 
{
    alert('Error message: '+msg+'\nURL: '+url+'\nLine Number: '+linenumber);
    return true;
};
</script>
</head>

<body class='full_screen'>

<div id='loading' class='full_screen'>&nbsp;<img height='12px' src='assets/spinner.gif'></img> Loading...</div>

<div id='clerkrole' class='role clerk_bg full_screen'>
    <div id='clerkvid' class='vid'>
        <video id="clerkvidfile" width="320" height="504" webkit-playsinline>
            <source src="assets/intro.mp4" type="video/mp4">
        </video>
        <div class='bottombutton' onclick='displayIntro();'>
            <img src='assets/forward_arrow.png' class='forwardarrow' />
        </div>
    </div>
    <div id='clerkintro' class='intro full_screen'>
        <img src='assets/clerk_prompt.png' class='introprompt' />
        <img src='assets/clerk.png' class='introimage' />
        <div class='introdialog'>
            I'm x. We're running low in inventory for our store. Trade these beaver pelts to the shippers from Europe to get more supplies. Blah blah blah (NOT FINAL TEXT).
        </div>
        <div class='bottombutton' onclick='ARIS.exitToScanner("Scan a clerk item behind the fur trade counter!");'>
            <img src='assets/forward_arrow.png' class='forwardarrow' />
        </div>
    </div>
    <div id='clerkget' class='get full_screen'>
        
    </div>
    <div id='clerktrade' class='trade full_screen'>
    </div>
    <div id='clerkguru' class='guru full_screen'>
        <img class='guruimage' src='assets/anton.png' />
        <div id='clerkgurutalk' class='gurutalk'></div>
        <div class='bottombutton' onclick='hideGuru();'>
            <img src='assets/forward_arrow.png' class='forwardarrow' />
        </div>
    </div>
</div>

<div id='hunterrole' class='role hunter_bg full_screen'>
    <div id='huntervid' class='vid'>
        <video id="huntervidfile" width="320" height="504" webkit-playsinline>
            <source src="assets/intro.mp4" type="video/mp4">
        </video>
        <div class='bottombutton' onclick='displayIntro();'>
            <img src='assets/forward_arrow.png' class='forwardarrow' />
        </div>
    </div>
    <div id='hunterintro' class='intro full_screen'>
        <img src='assets/hunter_prompt.png' class='introprompt' />
        <img src='assets/hunter.png' class='introimage' />
        <div class='introdialog'>
            I'm x. We hear that the Euro's are opening a store where they will give us some cool stuff for useless beaver pelts! Would you help us get some beaver pelts? Blah blah blah (NOT FINAL TEXT).
        </div>
        <div class='bottombutton' onclick='ARIS.exitToScanner("Scan a beaver pelt to hunt and collect it!");'>
            <img src='assets/forward_arrow.png' class='forwardarrow' />
        </div>
    </div>
    <div id='hunterget' class='get full_screen'>
    </div>
    <div id='huntertrade' class='trade full_screen'>
    </div>
    <div id='hunterguru' class='guru full_screen'>
        <img class='guruimage' src='assets/anton.png' />
        <div id='huntergurutalk' class='gurutalk'></div>
        <div class='bottombutton' onclick='hideGuru();'>
            <img src='assets/forward_arrow.png' class='forwardarrow' />
        </div>
    </div>
</div>

</body>
</html>
