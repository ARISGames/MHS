<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<meta name = "viewport" content = "width=device-width, user-scalable=no" />
<title>Trading Post</title>
<script type = "text/javascript" src = "arisjs.js"></script>

<script type = "text/javascript">
document.addEventListener('touchmove', function(e) {e.preventDefault();}, false);

function loadMe()
{
    setScene(sceneIntro);
    setTimeout(function(){initialize()},delay);
}

function setScene(scene)
{
    document.getElementById("loading").style.display="none";
    document.getElementById("intro").style.display="none";
    document.getElementById("trade").style.display="none";

    switch(scene)
    {
        case sceneLoading:
            document.getElementById("loading").style.display="block";
            break;
        case sceneIntro:
            document.getElementById("intro").style.display="block";
            break;
        case sceneTrade:
            document.getElementById("trade").style.display="block";
            break;
    }
}

//Constants
var delay = 300;
//Enums
var sceneLoading = 0;
var sceneIntro = 1;
var sceneTrade = 2;
var roleClerk = 0;
var roleHunter = 1;
var roleCrafter = 2;

//Game Data
var gameId; 
var playerId;
var webPageId;
    
var clerkItemIds = new Array(5,6,11,12);
var hunterItemIds = new Array(1,2,3,4);
var crafterItemIds = new Array(7,8,9,10);
var allItemIds = new Array(1,2,3,4,5,6,7,8,9,10,11,12);
var roleItemIds = new Array(clerkItemIds, hunterItemIds, crafterItemIds);
var pItems = new Array();
var pItemQtys = new Array();    

//Variables
var pLevel;
var pName;
var pRole;

var bumpProgress;

function initialize()
{
    //Get PlayerID and GameID from URL
    var params = parseURLParams(document.URL);
    gameId = parseInt(params.gameId);
    playerId = parseInt(params.playerId);
    webPageId = parseInt(params.webPageId);

    //Get Stuff from Server
    switch(webPageId)
    {
        case roleClerk:
            pName = "Clerk";
            pRole = roleClerk;
            break;
        case roleHunter:
            pName = "Hunter";
            pRole = roleHunter;
            break;
        case roleCrafter:
            pName = "Crafter";
            pRole = roleCrafter;
            break;
    }

    for(itemId in allItemIds)
        getItemCount(allItemIds[itemId]);

    //End Server Get

    //Set up the images
//    document.getElementById("kkomamon").style.backgroundImage = "url('images/" + kNames[kType] + ".gif')";


    //Begin Precaching Media
    //prepareMedia(kMediaIdMusic);
    //setMediaVolume(kMediaIdMusic,0.20);
    //prepareMedia(kMediaIdMiss); 
    //prepareMedia(kMediaIdPunch); 
    //prepareMedia(kMediaIdFire); 
    //prepareMedia(kMediaIdKiss); 
    //prepareMedia(kMediaIdWin); 
    //prepareMedia(kMediaIdLose); 

    //Start Music
    //playMedia(kMediaIdMusic);
}

function didUpdateItemQty(updatedItemId,qty)
{
  //Check all game-related item ids...
  for(itemId in allItemIds)
  {
    //if the updated itemId is relevant...
    if(updatedItemId == allitemIds[itemId])
    {
      var alreadyHaveIt = false;
      //For each of the items in your inventory
      for(myItemId in pItems)
      {
        //check if they are the same (you already have the item)
        if(updatedItemId == pItems[myItemId])
        {
          //correct its value
          alreadyHaveIt = true;
          pItemQtys[myItemsIs]=qty;
        }
      }
      //Otherwise
      if(!alreadyHaveIt)
      {
        //Add it to the array
        pItems.push(updatedItemId);
        pItemQtys.push(qty);
      }
    }
  }
}

//update health and xp in ARIS
//setItemCount(HEALTH_ITEM_ID, pHealth); //setItemCountForPlayer(gameId, playerId, HEALTH_ITEM_ID, pHealth);
//setItemCount(XP_ITEM_ID, pXP); //setItemCountForPlayer(gameId, playerId, XP_ITEM_ID, pXP);


</script>
<style>
div
{
    border-style:solid;
    border-width:1px;
    border-color:#FF0000;
    padding:0px;
    color:white;
    font-family:Noteworthy;
    font-weight:Bold;
}

body
{
  -webkit-user-select:none;
  user-select:none;
}

.scene
{
  /* For some reason, adding border fixes the white bar at the top. */
  border-style:solid;
  border-width:2px;
  border-color:#000000;
  width:100%;
  height:100%;
  display:none;
  background-color:#000000;
}

.subtitle
{
        
}
    
.screenSplit
{
        
}
    
.notifications
{
  
}
</style>
</head>
<body onLoad="loadMe()" style="margin:0px; padding:0px;">
<div id="tradeScreen" style="position:relative; margin:0px; width:320px; height:416px;">

<!-- Loading State -->
<div id="loading" class="scene" style="display:block;">
  <div style="color:#FFFFFF; position:absolute; top:198px; left:130px; height:20px; width:60px;">
  loading...
  </div>
</div>

<!-- Intro State -->
<div id="intro" class="scene">
</div>

<!-- Trade State -->    
<div id="trade" class="scene"> <!-- style="background-image:url('images/background7.jpg');" -->
 <div id="bumpLogo" class="subtitle">
 </div>
    
 <div id="inventory" class="screenSplit">
 </div>
    
 <div id="needs" class="screenSplit">
 </div>
    
 <div id="helperArea" class="notifications">
 </div>
</div>

<!-- Win State -->
<div id="win" class="scene">
  <div style="color:#FFFFFF; position:absolute; top:198px; left:130px; height:20px; width:60px;">
      YOU WIN
  </div>
</div>

<!-- Lose State -->    
<div id="lose" class="scene">
  <div style="color:#FFFFFF; position:absolute; top:198px; left:130px; height:20px; width:60px;">
      YOU LOSE
  </div>
</div>

</div><!-- body -->
</body>
</html>
