<!doctype html>

<html>

<head>
<meta charset="utf-8">
<title>Conscientious Objector</title>
<style>

  body { margin: 0; overflow: hidden; background: #111 }

</style>
</head>

<body>

<script type="text/javascript">

/*     
  PlaygroundJS r12
  http://playgroundjs.com
  (c) 2012-2016 http://rezoner.net
  Playground may be freely distributed under the MIT license.
*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var a=0;return function(b){return $jscomp.SYMBOL_PREFIX+(b||"")+a++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();var b=a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};
$jscomp.polyfill=function(a,b,c,e){if(b){c=$jscomp.global;a=a.split(".");for(e=0;e<a.length-1;e++){var d=a[e];d in c||(c[d]={});c=c[d]}a=a[a.length-1];e=c[a];b=b(e);b!=e&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(a){function b(){this.batch_=null}function c(a){return a instanceof d?a:new d(function(b,f){b(a)})}if(a&&!$jscomp.FORCE_POLYFILL_PROMISE)return a;b.prototype.asyncExecute=function(a){null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_());this.batch_.push(a);return this};b.prototype.asyncExecuteBatch_=function(){var a=this;this.asyncExecuteFunction(function(){a.executeBatch_()})};var e=$jscomp.global.setTimeout;b.prototype.asyncExecuteFunction=function(a){e(a,
0)};b.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=this.batch_;this.batch_=[];for(var b=0;b<a.length;++b){var f=a[b];a[b]=null;try{f()}catch(m){this.asyncThrow_(m)}}}this.batch_=null};b.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var d=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var b=this.createResolveAndReject_();try{a(b.resolve,b.reject)}catch(f){b.reject(f)}};d.prototype.createResolveAndReject_=
function(){function a(a){return function(m){f||(f=!0,a.call(b,m))}}var b=this,f=!1;return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};d.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof d)this.settleSameAsPromise_(a);else{a:switch(typeof a){case "object":var b=null!=a;break a;case "function":b=!0;break a;default:b=!1}b?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};d.prototype.resolveToNonPromiseObj_=function(a){var b=
void 0;try{b=a.then}catch(f){this.reject_(f);return}"function"==typeof b?this.settleSameAsThenable_(b,a):this.fulfill_(a)};d.prototype.reject_=function(a){this.settle_(2,a)};d.prototype.fulfill_=function(a){this.settle_(1,a)};d.prototype.settle_=function(a,b){if(0!=this.state_)throw Error("Cannot settle("+a+", "+b+"): Promise already settled in state"+this.state_);this.state_=a;this.result_=b;this.executeOnSettledCallbacks_()};d.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=
0;a<this.onSettledCallbacks_.length;++a)g.asyncExecute(this.onSettledCallbacks_[a]);this.onSettledCallbacks_=null}};var g=new b;d.prototype.settleSameAsPromise_=function(a){var b=this.createResolveAndReject_();a.callWhenSettled_(b.resolve,b.reject)};d.prototype.settleSameAsThenable_=function(a,b){var f=this.createResolveAndReject_();try{a.call(b,f.resolve,f.reject)}catch(m){f.reject(m)}};d.prototype.then=function(a,b){function f(f,a){return"function"==typeof f?function(a){try{m(f(a))}catch(q){l(q)}}:
a}var m,l,c=new d(function(f,a){m=f;l=a});this.callWhenSettled_(f(a,m),f(b,l));return c};d.prototype.catch=function(a){return this.then(void 0,a)};d.prototype.callWhenSettled_=function(a,b){function f(){switch(m.state_){case 1:a(m.result_);break;case 2:b(m.result_);break;default:throw Error("Unexpected state: "+m.state_);}}var m=this;null==this.onSettledCallbacks_?g.asyncExecute(f):this.onSettledCallbacks_.push(f)};d.resolve=c;d.reject=function(a){return new d(function(b,f){f(a)})};d.race=function(a){return new d(function(b,
f){for(var m=$jscomp.makeIterator(a),l=m.next();!l.done;l=m.next())c(l.value).callWhenSettled_(b,f)})};d.all=function(a){var b=$jscomp.makeIterator(a),f=b.next();return f.done?c([]):new d(function(a,l){function m(f){return function(b){d[f]=b;e--;0==e&&a(d)}}var d=[],e=0;do d.push(void 0),e++,c(f.value).callWhenSettled_(m(d.length-1),l),f=b.next();while(!f.done)})};return d},"es6","es3");
$jscomp.iteratorFromArray=function(a,b){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var c=0,e={next:function(){if(c<a.length){var d=c++;return{value:b(d,a[d]),done:!1}}e.next=function(){return{done:!0,value:void 0}};return e.next()}};e[Symbol.iterator]=function(){return e};return e};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");
$jscomp.polyfill("Array.prototype.fill",function(a){return a?a:function(a,c,e){var b=this.length||0;0>c&&(c=Math.max(0,b+c));if(null==e||e>b)e=b;e=Number(e);0>e&&(e=Math.max(0,b+e));for(c=Number(c||0);c<e;c++)this[c]=a;return this}},"es6","es3");$jscomp.checkEs6ConformanceViaProxy=function(){try{var a={},b=Object.create(new $jscomp.global.Proxy(a,{get:function(c,e,d){return c==a&&"q"==e&&d==b}}));return!0===b.q}catch(c){return!1}};$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;
$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();$jscomp.owns=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};
$jscomp.polyfill("WeakMap",function(a){function b(){if(!a||!Object.seal)return!1;try{var b=Object.seal({}),f=Object.seal({}),m=new a([[b,2],[f,3]]);if(2!=m.get(b)||3!=m.get(f))return!1;m.delete(b);m.set(f,4);return!m.has(b)&&4==m.get(f)}catch(l){return!1}}function c(a){$jscomp.owns(a,d)||$jscomp.defineProperty(a,d,{value:{}})}function e(a){var f=Object[a];f&&(Object[a]=function(a){c(a);return f(a)})}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE)return a}else if(b())return a;
var d="$jscomp_hidden_"+Math.random();e("freeze");e("preventExtensions");e("seal");var g=0,h=function(a){this.id_=(g+=Math.random()+1).toString();if(a){$jscomp.initSymbol();$jscomp.initSymbolIterator();a=$jscomp.makeIterator(a);for(var f;!(f=a.next()).done;)f=f.value,this.set(f[0],f[1])}};h.prototype.set=function(a,f){c(a);if(!$jscomp.owns(a,d))throw Error("WeakMap key fail: "+a);a[d][this.id_]=f;return this};h.prototype.get=function(a){return $jscomp.owns(a,d)?a[d][this.id_]:void 0};h.prototype.has=
function(a){return $jscomp.owns(a,d)&&$jscomp.owns(a[d],this.id_)};h.prototype.delete=function(a){return $jscomp.owns(a,d)&&$jscomp.owns(a[d],this.id_)?delete a[d][this.id_]:!1};return h},"es6","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(a){function b(){if($jscomp.ASSUME_NO_NATIVE_MAP||!a||"function"!=typeof a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var f=Object.seal({x:4}),b=new a($jscomp.makeIterator([[f,"s"]]));if("s"!=b.get(f)||1!=b.size||b.get({x:4})||b.set({x:4},"t")!=b||2!=b.size)return!1;var l=b.entries(),c=l.next();if(c.done||c.value[0]!=f||"s"!=c.value[1])return!1;c=l.next();return c.done||4!=c.value[0].x||"t"!=c.value[1]||!l.next().done?!1:!0}catch(t){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE)return a}else if(b())return a;$jscomp.initSymbol();$jscomp.initSymbolIterator();var c=new WeakMap,e=function(a){this.data_={};this.head_=h();this.size=0;if(a){a=$jscomp.makeIterator(a);for(var f;!(f=a.next()).done;)f=f.value,this.set(f[0],f[1])}};e.prototype.set=function(a,b){var f=d(this,a);f.list||(f.list=this.data_[f.id]=[]);f.entry?f.entry.value=b:(f.entry={next:this.head_,previous:this.head_.previous,head:this.head_,
key:a,value:b},f.list.push(f.entry),this.head_.previous.next=f.entry,this.head_.previous=f.entry,this.size++);return this};e.prototype.delete=function(a){a=d(this,a);return a.entry&&a.list?(a.list.splice(a.index,1),a.list.length||delete this.data_[a.id],a.entry.previous.next=a.entry.next,a.entry.next.previous=a.entry.previous,a.entry.head=null,this.size--,!0):!1};e.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=h();this.size=0};e.prototype.has=function(a){return!!d(this,a).entry};
e.prototype.get=function(a){return(a=d(this,a).entry)&&a.value};e.prototype.entries=function(){return g(this,function(a){return[a.key,a.value]})};e.prototype.keys=function(){return g(this,function(a){return a.key})};e.prototype.values=function(){return g(this,function(a){return a.value})};e.prototype.forEach=function(a,b){for(var f=this.entries(),m;!(m=f.next()).done;)m=m.value,a.call(b,m[1],m[0],this)};e.prototype[Symbol.iterator]=e.prototype.entries;var d=function(a,b){var f=b&&typeof b;"object"==
f||"function"==f?c.has(b)?f=c.get(b):(f=""+ ++n,c.set(b,f)):f="p_"+b;var m=a.data_[f];if(m&&$jscomp.owns(a.data_,f))for(a=0;a<m.length;a++){var d=m[a];if(b!==b&&d.key!==d.key||b===d.key)return{id:f,list:m,index:a,entry:d}}return{id:f,list:m,index:-1,entry:void 0}},g=function(a,b){var f=a.head_;return $jscomp.iteratorPrototype(function(){if(f){for(;f.head!=a.head_;)f=f.previous;for(;f.next!=f.head;)return f=f.next,{done:!1,value:b(f)};f=null}return{done:!0,value:void 0}})},h=function(){var a={};return a.previous=
a.next=a.head=a},n=0;return e},"es6","es3");
(function(){var a=function(b,c){return"function"===typeof a.cache[c]?a.cache[c](b):a.spline(b,c||a.defaultEasing)};(function(){for(var a=1;a<arguments.length;a++)for(var c in arguments[a])arguments[0][c]=arguments[a][c];return arguments[0]})(a,{defaultEasing:"016",cache:{linear:function(a){return a},inQuad:function(a){return a*a},outQuad:function(a){return a*(2-a)},inOutQuad:function(a){return.5>a?2*a*a:-1+(4-2*a)*a},inCubic:function(a){return a*a*a},outCubic:function(a){return--a*a*a+1},inOutCubic:function(a){return.5>
a?4*a*a*a:(a-1)*(2*a-2)*(2*a-2)+1},inQuart:function(a){return a*a*a*a},outQuart:function(a){return 1- --a*a*a*a},inOutQuart:function(a){return.5>a?8*a*a*a*a:1-8*--a*a*a*a},inQuint:function(a){return a*a*a*a*a},outQuint:function(a){return 1+--a*a*a*a*a},inOutQuint:function(a){return.5>a?16*a*a*a*a*a:1+16*--a*a*a*a*a},inSine:function(a){return-1*Math.cos(a/1*.5*Math.PI)+1},outSine:function(a){return Math.sin(a/1*.5*Math.PI)},inOutSine:function(a){return-.5*(Math.cos(Math.PI*a)-1)},inExpo:function(a){return 0==
a?0:Math.pow(2,10*(a-1))},outExpo:function(a){return 1==a?1:-Math.pow(2,-10*a)+1},inOutExpo:function(a){return 0==a?0:1==a?1:1>(a/=.5)?.5*Math.pow(2,10*(a-1)):.5*(-Math.pow(2,-10*--a)+2)},inCirc:function(a){return-1*(Math.sqrt(1-a*a)-1)},outCirc:function(a){return Math.sqrt(1- --a*a)},inOutCirc:function(a){return 1>(a/=.5)?-.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1)},inElastic:function(a){var b=0,e=1;if(0==a)return 0;if(1==a)return 1;b||(b=.3);if(1>e){e=1;var d=b/4}else d=b/(2*Math.PI)*
Math.asin(1/e);return-(e*Math.pow(2,10*--a)*Math.sin(2*(a-d)*Math.PI/b))},outElastic:function(a){var b=0,e=1;if(0==a)return 0;if(1==a)return 1;b||(b=.3);if(1>e){e=1;var d=b/4}else d=b/(2*Math.PI)*Math.asin(1/e);return e*Math.pow(2,-10*a)*Math.sin(2*(a-d)*Math.PI/b)+1},inOutElastic:function(a){var b=0,e=1;if(0==a)return 0;if(2==(a/=.5))return 1;b||(b=.3*1.5);if(1>e){e=1;var d=b/4}else d=b/(2*Math.PI)*Math.asin(1/e);return 1>a?-.5*e*Math.pow(2,10*--a)*Math.sin(2*(a-d)*Math.PI/b):e*Math.pow(2,-10*--a)*
Math.sin(2*(a-d)*Math.PI/b)*.5+1},inBack:function(a,c){void 0==c&&(c=1.70158);return 1*a*a*((c+1)*a-c)},outBack:function(a,c){void 0==c&&(c=1.70158);return(a=a/1-1)*a*((c+1)*a+c)+1},inOutBack:function(a,c){void 0==c&&(c=1.70158);return 1>(a/=.5)?.5*a*a*(((c*=1.525)+1)*a-c):.5*((a-=2)*a*(((c*=1.525)+1)*a+c)+2)},inBounce:function(a){return 1-this.outBounce(1-a)},outBounce:function(a){return(a/=1)<1/2.75?7.5625*a*a:a<2/2.75?7.5625*(a-=1.5/2.75)*a+.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=
2.625/2.75)*a+.984375},inOutBounce:function(a){return.5>a?.5*this.inBounce(2*a):.5*this.outBounce(2*a-1)+.5}},translateEasing:function(a){if(!this.cache[a]){for(var b=a.split(""),e=1,d=!1,g=!1,h=0;h<b.length;h++){var n=b[h];"-"===n?(e=-1,d=!0,b.splice(h--,1)):"+"===n?(e=1,b.splice(h--,1)):"t"===n?(g=!g,b.splice(h--,1)):b[h]=parseInt(b[h],16)*e}e=Math.min.apply(null,b);n=Math.max.apply(null,b);var f=[];for(h=0;h<b.length;h++){if(d){var m=Math.max(Math.abs(e),Math.abs(n));m=b[h]/m}else m=n-e,m=(b[h]-
e)/m;g&&(0>m&&(m=0),1<m&&(m=1));f.push(m)}this.cache[a]=f}return this.cache[a]},splineK:{},splineX:{},splineY:{},insertIntermediateValues:function(a){for(var b=[],e=0;e<a.length;e++)b.push(a[e]),e<a.length-1&&b.push(a[e+1]+.6*(a[e]-a[e+1]));return b},spline:function(a,c){if(!this.splineK[c]){var b=[],d=this.translateEasing(c);if(!d.length)return 0;for(var g=0;g<d.length;g++)b.push(1/(d.length-1)*g);var h=b.map(function(){return 0});h=this.getNaturalKs(b,d,h);this.splineX[c]=b;this.splineY[c]=d;this.splineK[c]=
h}if(1<a)return this.splineY[c][this.splineY[c].length-1];h=this.splineK[c];b=this.splineX[c];d=this.splineY[c];for(g=1;b[g]<a;)g++;a=(a-b[g-1])/(b[g]-b[g-1]);return(1-a)*d[g-1]+a*d[g]+a*(1-a)*((h[g-1]*(b[g]-b[g-1])-(d[g]-d[g-1]))*(1-a)+(-h[g]*(b[g]-b[g-1])+(d[g]-d[g-1]))*a)},getNaturalKs:function(a,c,e){for(var b=a.length-1,g=this.zerosMat(b+1,b+2),h=1;h<b;h++)g[h][h-1]=1/(a[h]-a[h-1]),g[h][h]=2*(1/(a[h]-a[h-1])+1/(a[h+1]-a[h])),g[h][h+1]=1/(a[h+1]-a[h]),g[h][b+1]=3*((c[h]-c[h-1])/((a[h]-a[h-1])*
(a[h]-a[h-1]))+(c[h+1]-c[h])/((a[h+1]-a[h])*(a[h+1]-a[h])));g[0][0]=2/(a[1]-a[0]);g[0][1]=1/(a[1]-a[0]);g[0][b+1]=3*(c[1]-c[0])/((a[1]-a[0])*(a[1]-a[0]));g[b][b-1]=1/(a[b]-a[b-1]);g[b][b]=2/(a[b]-a[b-1]);g[b][b+1]=3*(c[b]-c[b-1])/((a[b]-a[b-1])*(a[b]-a[b-1]));return this.solve(g,e)},solve:function(a,c){for(var b=a.length,d=0;d<b;d++){for(var g=0,h=Number.NEGATIVE_INFINITY,n=d;n<b;n++)a[n][d]>h&&(g=n,h=a[n][d]);this.splineSwapRows(a,d,g);for(n=d+1;n<b;n++){for(g=d+1;g<b+1;g++)a[n][g]-=a[n][d]/a[d][d]*
a[d][g];a[n][d]=0}}for(n=b-1;0<=n;n--)for(d=a[n][b]/a[n][n],c[n]=d,g=n-1;0<=g;g--)a[g][b]-=a[g][n]*d,a[g][n]=0;return c},zerosMat:function(a,c){for(var b=[],d=0;d<a;d++){b.push([]);for(var g=0;g<c;g++)b[d].push(0)}return b},splineSwapRows:function(a,c,e){var b=a[c];a[c]=a[e];a[e]=b}});window.ease=a})();window.PLAYGROUND={};PLAYGROUND.MOBILE=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);function playground(a){return new PLAYGROUND.Application(a)}
PLAYGROUND.Utils={extend:function(){for(var a=1;a<arguments.length;a++)for(var b in arguments[a])arguments[0][b]=arguments[a][b];return arguments[0]},defaults:function(){for(var a=1;a<arguments.length;a++)for(var b in arguments[a])"undefined"===typeof arguments[0][b]&&(arguments[0][b]=arguments[a][b]);return arguments[0]},merge:function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b],e;for(e in c){var d=c[e];"undefined"!==typeof a[e]?"object"===typeof a[e]?this.merge(a[e],d):a[e]=d:a[e]=
d}}return a},invoke:function(a,b){for(var c=Array.prototype.slice.call(arguments,2),e=0;e<a.length;e++){var d=a[e];d[b]&&d[b].apply(d,c)}},throttle:function(a,b){var c,e=0;return function(){for(var d=[],g=0;g<arguments.length;g++)d.push(arguments[g]);var h=this;Date.now()-e>b?(e=Date.now(),a.apply(h,d),clearTimeout(c)):(clearTimeout(c),c=setTimeout(function(){a.apply(h,d);e=Date.now()},Date.now()-e))}},wrapTo:function(a,b,c,e){if(a===b)return b;var d=a;a=this.wrappedDistance(a,b,c);if(Math.abs(a)<
e)return b;d+=(0>a?-1:1)*e;d>c?d-=c:0>d&&(d=c+d);return d},wrap:function(a,b,c){return a<b?c+a%c:a>=c?a%c:a},circWrap:function(a){return this.wrap(a,0,2*Math.PI)},circWrapTo:function(a,b,c){return this.wrapTo(a,b,2*Math.PI,c)},wrappedDistance:function(a,b,c){if(a===b)return 0;if(a<b){var e=-a-c+b;a=b-a}else e=b-a,a=c-a+b;return Math.abs(e)>Math.abs(a)?a:e},circWrappedDistance:function(a,b){return this.wrappedDistance(a,b,2*Math.PI)},ground:function(a,b){return(a/b|0)*b},circDistance:function(a,b){return this.circWrappedDistance(a,
b)},distance:function(a,b,c,e){if(2<arguments.length)var d=a-c,g=b-e;else d=a.x-b.x,g=a.y-b.y;return Math.sqrt(d*d+g*g)},sprintf:function(a,b){for(var c in b)a=a.replace(new RegExp("{"+c+"}","g"),b[c]);return a}};PLAYGROUND.Utils.ease=ease;PLAYGROUND.Events=function(){this.listeners={}};
PLAYGROUND.Events.prototype={on:function(a,b,c){if("object"===typeof a){b={};for(var e in a)b[e]=this.on(e,a[e],c);return b}this.listeners[a]||(this.listeners[a]=[]);c={once:!1,callback:b,context:c};this.listeners[a].push(c);return c},once:function(a,b,c){if("object"===typeof a){b={};for(var e in a)b[e]=this.once(e,a[e],c);return b}this.listeners[a]||(this.listeners[a]=[]);c={once:!0,callback:b,context:c};this.listeners[a].push(c);return c},off:function(a,b){for(var c=0,e=this.listeners[a].length;c<
e;c++)this.listeners[a][c]===b&&(this.listeners[a].splice(c--,1),e--)},trigger:function(a,b){if(this.listeners.event)for(var c=0,e=this.listeners.event.length;c<e;c++){var d=this.listeners.event[c];d.callback.call(d.context||this,a,b)}if(this.listeners[a])for(c=0,e=this.listeners[a].length;c<e;c++)d=this.listeners[a][c],d.callback.call(d.context||this,b),d.once&&(this.listeners[a].splice(c--,1),e--)}};PLAYGROUND.States=function(a){this.app=a;PLAYGROUND.Events.call(this);a.on("step",this.step.bind(this))};
PLAYGROUND.States.prototype={step:function(a){!this.next||this.current&&this.current.locked||(a=this.next,"function"===typeof a&&(a=new a),a.__created||(a.__created=!0,a.app=this.app,this.trigger("createstate",{state:a}),a.create&&a.create()),this.current&&this.trigger("leavestate",{prev:this.current,next:a,state:this.current}),this.trigger("enterstate",{prev:this.current,next:a,state:a}),(this.current=a)&&this.current.enter&&this.current.enter(),this.app.state=this.current,this.next=!1)},set:function(a){this.current&&
this.current.leave&&this.current.leave();this.next=a;this.step(0)}};PLAYGROUND.Utils.extend(PLAYGROUND.States.prototype,PLAYGROUND.Events.prototype);
PLAYGROUND.Application=function(a){var b=this;this.killed=!1;PLAYGROUND.Events.call(this);PLAYGROUND.Utils.merge(this,this.defaults,a);this.autoWidth=this.width?!1:!0;this.autoHeight=this.height?!1:!0;this.autoScale=this.scale?!1:!0;this.container||(this.container=document.body);this.container!==document.body&&(this.customContainer=!0);"string"===typeof this.container&&(this.container=document.querySelector(this.container));this.container.style.background=this.background;this.updateSize();this.states=
new PLAYGROUND.States(this);this.states.on("event",this.emitLocalEvent,this);this.mouse=new PLAYGROUND.Mouse(this,this.container);this.mouse.on("event",this.emitGlobalEvent,this);this.touch=new PLAYGROUND.Touch(this,this.container);this.touch.on("event",this.emitGlobalEvent,this);this.keyboard=new PLAYGROUND.Keyboard(this);this.keyboard.on("event",this.emitGlobalEvent,this);this.gamepads=new PLAYGROUND.Gamepads(this);this.gamepads.on("event",this.emitGlobalEvent,this);this.tweens=new PLAYGROUND.TweenManager(this);
this.ease=PLAYGROUND.Utils.ease;PLAYGROUND.Sound(this);document.addEventListener("visibilitychange",this.handleVisibilityChange.bind(this));this.resizelistener=PLAYGROUND.Utils.throttle(this.handleResize.bind(this),100);window.addEventListener("resize",this.resizelistener);this.images={};this.atlases={};this.data={};this.loader=new PLAYGROUND.Loader(this);this.loadFoo(.25);this.plugins=[];for(var c in PLAYGROUND)a=PLAYGROUND[c],a.plugin&&this.plugins.push(new a(this));this.emitLocalEvent("preload");
this.firstBatch=!0;this.disabledUntilLoaded&&(this.skipEvents=!0);this.loader.once("ready",function(){b.loadFoo(.25);setTimeout(function(){b.emitLocalEvent("create");b.setState(PLAYGROUND.DefaultState);b.handleResize();PLAYGROUND.LoadingScreen&&b.setState(PLAYGROUND.LoadingScreen);PLAYGROUND.GameLoop(b);b.loader.once("ready",function(){b.firstBatch=!1;b.disabledUntilLoaded&&(b.skipEvents=!1);b.setState(PLAYGROUND.DefaultState);b.emitLocalEvent("ready");b.handleResize()})})})};
PLAYGROUND.Application.prototype={defaults:{background:"#272822",smoothing:1,paths:{base:"",images:"images/",fonts:"fonts/"},offsetX:0,offsetY:0,skipEvents:!1,disabledUntilLoaded:!0},setState:function(a){this.states.set(a)},insertAsset:function(a,b,c){c=c.split("/");for(var e=0;e<c.length-1;e++){var d=c[e];b[d]||(b[d]={});b=b[d]}b[c.pop()]=a},getPath:function(a){return this.paths.base+(this.paths[a]||a+"/")},getAssetEntry:function(a,b,c){b=this.paths[b]||b+"/";var e=a.match(/(.*)\..*/);e=e?e[1]:a;
var d=a.split("."),g=a;if(1<d.length){var h=d.pop();a=d.join(".")}else h=c,g+="."+c;return{key:e,url:this.paths.base+b+g,path:this.paths.base+b+a,ext:h}},emitLocalEvent:function(a,b){this.trigger(a,b);if(("render"!==a||!this.skipEvents||this.loader.ready)&&this[a])this[a](b)},emitGlobalEvent:function(a,b){if(!this.state)return this.emitLocalEvent(a,b);this.trigger(a,b);"render"===a&&this.skipEvents&&!this.loader.ready||!this.event||this.event(a,b);if(("render"!==a||!this.skipEvents||this.loader.ready)&&
this[a])this[a](b);this.state.event&&this.state.event(a,b);if(this.state[a])this.state[a](b);this.trigger("after"+a,b)},updateSize:function(){if(this.customContainer)var a=this.container.offsetWidth,b=this.container.offsetHeight;else a=window.innerWidth,b=window.innerHeight;if(this.autoScale||this.autoWidth||this.autoHeight)!this.autoHeight&&this.autoWidth?(this.autoScale&&(this.scale=b/this.height),this.width=Math.ceil(a/this.scale)):!this.autoWidth&&this.autoHeight?(this.autoScale&&(this.scale=
a/this.width),this.height=Math.ceil(b/this.scale)):this.autoWidth&&this.autoHeight&&this.autoScale?(this.scale=1,this.width=a,this.height=b):this.autoWidth&&this.autoHeight?(this.width=Math.ceil(a/this.scale),this.height=Math.ceil(b/this.scale)):this.scale=Math.min(a/this.width,b/this.height);this.offsetX=(a-this.width*this.scale)/2|0;this.offsetY=(b-this.height*this.scale)/2|0;this.center={x:this.width/2|0,y:this.height/2|0}},handleVisibilityChange:function(){this.emitGlobalEvent("visibilitychange",
{visible:!document.hidden,hidden:document.hidden})},handleResize:function(){this.emitGlobalEvent("beforeresize",{});this.updateSize();this.mouse.handleResize();this.touch.handleResize();this.emitGlobalEvent("resize",{})},request:function(a){return new Promise(function(b,c){var e=new XMLHttpRequest;e.open("GET",a,!0);e.onload=function(d){d=d.target;if(200!==d.status&&0!==d.status)return c(Error("Failed to get "+a));b(d)};e.send()})},loadFoo:function(a){var b=this.loader;this.loader.add("foo "+a);setTimeout(function(){b.success("foo "+
a)},1E3*a)},loadData:function(){for(var a=0;a<arguments.length;a++){var b=arguments[a];if("object"===typeof b)for(var c in b)this.loadData(b[c]);else this.loadDataItem(b)}},loadDataItem:function(a){var b=this.getAssetEntry(a,"data","json"),c=this;this.loader.add();this.request(b.url).then(function(a){var d=-1<b.key.indexOf("/");"json"===b.ext?(a=JSON.parse(a.responseText),d?(d=b.key.split("/")[0],c.data[d]||(c.data[d]={}),PLAYGROUND.Utils.extend(c.data[d],a)):(c.data[b.key]||(c.data[b.key]={}),PLAYGROUND.Utils.defaults(c.data[b.key],
a))):d?(d=b.key.split("/")[0],c.data[d]||(c.data[d]=""),c.data[b.key]+=a.responseText):c.data[b.key]=a.responseText;c.loader.success(b.url)})},loadImage:function(){return this.loadImages.apply(this,arguments)},loadImages:function(){for(var a=[],b=0;b<arguments.length;b++){var c=arguments[b];if("object"===typeof c)for(var e in c)a=a.concat(this.loadImages(c[e]));else a.push(this.loadOneImage(c))}return Promise.all(a)},loadOneImage:function(a){var b=this;this._imageLoaders||(this._imageLoaders={});
this._imageLoaders[a]||(b._imageLoaders[a]=new Promise(function(c,e){var d=b.loader,g=b.getAssetEntry(a,"images","png");b.loader.add(g.path);var h=new Image;h.addEventListener("load",function(){b.images[g.key]=h;c(h);d.success(g.url);g.image=h;b.insertAsset(h,b.images,g.key);b.emitLocalEvent("imageready",g)});h.addEventListener("error",function(){e("can't load "+g.url);d.error(g.url)});h.src=g.url}));return this._imageLoaders[a]},loadFont:function(){for(var a=[],b=0;b<arguments.length;b++)a.push(this.loadFontItem(arguments[b]));
return Promise.all(a)},loadFonts:function(){return this.loadFont.apply(this,arguments)},loadFontItem:function(a){if(!this.fontStyleSheet){var b=document.createElement("style");document.head.appendChild(b);this.fontStyleSheet=b}b=this.getAssetEntry(a,"fonts","ttf");b=PLAYGROUND.Utils.sprintf("@font-face { font-family: '{name}'; font-style: 'normal'; font-weight: 400, 800; src: url(fonts/{name}.{ext}) format('{format}'); }",{name:a,ext:b.ext,format:{woff:"woff",otf:"opentype",ttf:"truetype"}[b.ext]});
this.fontStyleSheet.innerHTML+=b;var c=this;this._fontPromises||(this._fontPromises={});this._fontPromises[a]||(this._fontPromises[a]=new Promise(function(b,d){c.loader.add("font "+a);var e=setInterval(function(){var d=cq(100,32).font("14px somethingrandom").fillStyle("#fff").textBaseline("top");d.context.fillText("lorem ipsum dolores sit",0,4);var g=cq(100,32).font("14px '"+a+"'").fillStyle("#fff").textBaseline("top");g.context.fillText("lorem ipsum dolores sit",0,4);cq.compare(d,g)||(c.loader.success("font"+
a),clearInterval(e),b())},100)}));return this._fontPromises[a]},render:function(){},enableInputs:function(){this.mouse.enabled=!0;this.touch.enabled=!0;this.keyboard.enabled=!0},disableInputs:function(){this.mouse.enabled=!1;this.touch.enabled=!1;this.keyboard.enabled=!1},kill:function(){this.killed=!0;this.trigger("kill");window.removeEventListener("resize",this.resizelistener)}};PLAYGROUND.Utils.extend(PLAYGROUND.Application.prototype,PLAYGROUND.Events.prototype);
PLAYGROUND.GameLoop=function(a){function b(){if(!a.killed){requestAnimationFrame(b);if(a.frameskip)if(e++,e===a.frameskip)e=0;else return;var d=Date.now()-c;c=Date.now();if(!(1E3<d)){var g=d/1E3;a.lifetime+=g;a.elapsed=g;a.emitGlobalEvent("step",g);a.emitGlobalEvent("prerender",g);a.emitGlobalEvent("render",g);a.emitGlobalEvent("postrender",g);a.opcost=d/1E3;a.ops=1E3/a.opcost}}}a.lifetime=0;a.ops=0;a.opcost=0;var c=Date.now(),e=0;requestAnimationFrame(b)};
PLAYGROUND.Gamepads=function(a){this.app=a;PLAYGROUND.Events.call(this);this.getGamepads=navigator.getGamepads||navigator.webkitGetGamepads;this.gamepadmoveEvent={};this.gamepaddownEvent={};this.gamepadupEvent={};this.gamepadholdEvent={};this.gamepads={};this.app.on("step",this.step.bind(this))};
PLAYGROUND.Gamepads.prototype={buttons:{0:"1",1:"2",2:"3",3:"4",4:"l1",5:"r1",6:"l2",7:"r2",8:"select",9:"start",12:"up",13:"down",14:"left",15:"right"},zeroState:function(){for(var a=[],b=0;15>=b;b++)a.push({pressed:!1,value:0});return{axes:[],buttons:a}},createGamepad:function(){for(var a={buttons:{},sticks:[{x:0,y:0},{x:0,y:0}]},b=0;16>b;b++)a.buttons[this.buttons[b]]=!1;return a},step:function(){if(navigator.getGamepads)for(var a=navigator.getGamepads(),b=0;b<a.length;b++){var c=a[b];if(c){this[b]||
(this[b]=this.createGamepad());for(var e=[].concat(c.buttons),d=12;15>=d;d++)e[d]={pressed:!1,value:0};d=this[b];if(c.axes){.01<Math.abs(c.axes[0])&&(0>c.axes[0]&&(e[14].pressed=!0),0<c.axes[0]&&(e[15].pressed=!0));.01<Math.abs(c.axes[1])&&(0>c.axes[1]&&(e[12].pressed=!0),0<c.axes[1]&&(e[13].pressed=!0));var g=!1,h=!1,n=!1;d.sticks[0].x!==c.axes[0]&&(h=g=!0);d.sticks[0].y!==c.axes[1]&&(h=g=!0);d.sticks[1].x!==c.axes[2]&&(n=g=!0);d.sticks[1].y!==c.axes[3]&&(n=g=!0);g&&(this.gamepadmoveEvent.old=[PLAYGROUND.Utils.extend({},
d.sticks[0]),PLAYGROUND.Utils.extend({},d.sticks[1])],d.sticks[0].x=c.axes[0],d.sticks[0].y=c.axes[1],d.sticks[1].x=c.axes[2],d.sticks[1].y=c.axes[3],this.gamepadmoveEvent.sticks=d.sticks,this.gamepadmoveEvent.a=h?d.sticks[0]:!1,this.gamepadmoveEvent.b=n?d.sticks[1]:!1,this.gamepadmoveEvent.gamepad=b,this.trigger("gamepadmove",this.gamepadmoveEvent))}for(c=0;c<e.length;c++)g=this.buttons[c],e[c].pressed&&!d.buttons[g]&&(d.buttons[g]=!0,this.gamepaddownEvent.button=this.buttons[c],this.gamepaddownEvent.gamepad=
b,this.trigger("gamepaddown",this.gamepaddownEvent)),e[c].pressed?(this.gamepadholdEvent.button=this.buttons[c],this.gamepadholdEvent.gamepad=b,this.gamepadholdEvent.dt=this.app.elapsed,this.trigger("gamepadhold",this.gamepadholdEvent)):!e[c].pressed&&d.buttons[g]&&(d.buttons[g]=!1,this.gamepadupEvent.button=this.buttons[c],this.gamepadupEvent.gamepad=b,this.trigger("gamepadup",this.gamepadupEvent))}}}};PLAYGROUND.Utils.extend(PLAYGROUND.Gamepads.prototype,PLAYGROUND.Events.prototype);
PLAYGROUND.Keyboard=function(a){PLAYGROUND.Events.call(this);this.app=a;this.keys={};this.any=!1;this.keydownlistener=this.keydown.bind(this);this.keyuplistener=this.keyup.bind(this);this.keypresslistener=this.keypress.bind(this);document.addEventListener("keydown",this.keydownlistener);document.addEventListener("keyup",this.keyuplistener);document.addEventListener("keypress",this.keypresslistener);this.keydownEvent={};this.keyupEvent={};this.keypressEvent={};this.enabled=this.preventDefault=!0;this.app.on("kill",
this.kill.bind(this))};
PLAYGROUND.Keyboard.prototype={kill:function(){document.removeEventListener("keydown",this.keydownlistener);document.removeEventListener("keyup",this.keyuplistener);document.removeEventListener("keypress",this.keypresslistener)},keycodes:{37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete",8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"escape",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",96:"numpad0",97:"numpad1",98:"numpad2",99:"numpad3",
100:"numpad4",101:"numpad5",102:"numpad6",103:"numpad7",104:"numpad8",105:"numpad9",106:"numpadmul",107:"numpadadd",109:"numpadsub",110:"numpaddec",111:"numpaddiv",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scrolllock",186:"semicolon",187:"equal",188:"comma",189:"dash",190:"period",191:"slash",192:"graveaccent",219:"openbracket",220:"backslash",221:"closebraket",222:"singlequote"},bypassKeys:"f12 f11 f5 ctrl alt shift".split(" "),
keydown:function(a){if(this.enabled){var b=48<=a.which&&90>=a.which?String.fromCharCode(a.which).toLowerCase():this.keycodes[a.which];if(!this.keys[b]&&(this.any++,this.keydownEvent.key=b,this.keydownEvent.original=a,this.keys[b]=!0,this.trigger("keydown",this.keydownEvent),this.preventDefault&&document.activeElement===document.body)){b=a.metaKey;if(!b)for(var c=0;c<this.bypassKeys.length;c++)if(this.keys[this.bypassKeys[c]]){b=!0;break}b||(a.preventDefault(),a.stopPropagation())}}},keyup:function(a){if(this.enabled){var b=
48<=a.which&&90>=a.which?String.fromCharCode(a.which).toLowerCase():this.keycodes[a.which];this.any--;this.keyupEvent.key=b;this.keyupEvent.original=a;this.keys[b]=!1;this.trigger("keyup",this.keyupEvent)}},keypress:function(a){if(this.enabled){var b=48<=a.which&&90>=a.which?String.fromCharCode(a.which).toLowerCase():this.keycodes[a.which];this.keypressEvent.key=b;this.keypressEvent.original=a;this.trigger("keypress",this.keypressEvent)}}};PLAYGROUND.Utils.extend(PLAYGROUND.Keyboard.prototype,PLAYGROUND.Events.prototype);
PLAYGROUND.Pointer=function(a){this.app=a;a.on("touchstart",this.touchstart,this);a.on("touchend",this.touchend,this);a.on("touchmove",this.touchmove,this);a.on("mousemove",this.mousemove,this);a.on("mousedown",this.mousedown,this);a.on("mouseup",this.mouseup,this);a.on("mousewheel",this.mousewheel,this);this.pointers=a.pointers={};this.lastTap=0};PLAYGROUND.Pointer.plugin=!0;
PLAYGROUND.Pointer.prototype={updatePointer:function(a){this.pointers[a.id]||(this.pointers[a.id]={});var b=this.pointers[a.id];b.x=a.x;b.y=a.y;b.id=a.id;return b},removePointer:function(a){delete this.pointers[a.id]},touchstart:function(a){a.touch=!0;this.updatePointer(a);this.pointerdown(a);this.app.emitGlobalEvent("pointerdown",a)},touchend:function(a){a.touch=!0;this.pointerup(a);this.removePointer(a);this.app.emitGlobalEvent("pointerup",a)},touchmove:function(a){a.touch=!0;this.updatePointer(a);
this.pointermove(a);this.app.emitGlobalEvent("pointermove",a)},mousemove:function(a){a.mouse=!0;this.updatePointer(a);this.pointermove(a);this.app.emitGlobalEvent("pointermove",a)},mousedown:function(a){a.mouse=!0;this.updatePointer(a);this.app.emitGlobalEvent("pointerdown",a);this.pointerdown(a)},mouseup:function(a){a.mouse=!0;this.pointerup(a);this.app.emitGlobalEvent("pointerup",a)},mousewheel:function(a){a.mouse=!0;this.app.emitGlobalEvent("pointerwheel",a)},pointerdown:function(a){var b=this.pointers[a.id];
b.pressed=!0;var c=this.app.lifetime-b.lastTap;b.lastTap=this.app.lifetime;.4>c&&b.tapPosition&&5>PLAYGROUND.Utils.distance(b,b.tapPosition)&&(this.app.emitGlobalEvent("pointerdoubletap",b),b.lastTap=0);b.tapPosition={x:a.x,y:a.y}},pointermove:function(a){var b=this.pointers[a.id];!b.dragging&&b.pressed&&5<PLAYGROUND.Utils.distance(b.tapPosition,a)&&(b.dragging=!0);a.dragging=b.dragging},pointerup:function(a){a=this.pointers[a.id];a.pressed=!1;a.dragging=!1}};
PLAYGROUND.Loader=function(a){this.app=a;PLAYGROUND.Events.call(this);this.reset()};PLAYGROUND.Loader.prototype={add:function(a){this.queue++;this.count++;this.ready=!1;this.trigger("add",a);return a},error:function(a){this.trigger("error",a)},success:function(a){this.queue--;this.progress=1-this.queue/this.count;this.trigger("load",a);0>=this.queue&&(this.reset(),this.trigger("ready"))},reset:function(){this.count=this.queue=this.progress=0;this.ready=!0}};
PLAYGROUND.Utils.extend(PLAYGROUND.Loader.prototype,PLAYGROUND.Events.prototype);
PLAYGROUND.Mouse=function(a,b){var c=this;this.app=a;PLAYGROUND.Events.call(this);this.element=b;this.enabled=this.preventContextMenu=!0;this.mousemoveEvent={};this.mousedownEvent={};this.mouseupEvent={};this.mousewheelEvent={};this.y=this.x=0;this.mousemovelistener=this.mousemove.bind(this);this.mousedownlistener=this.mousedown.bind(this);this.mouseuplistener=this.mouseup.bind(this);this.mouseoutlistener=this.mouseout.bind(this);this.contextmenulistener=function(a){c.preventContextMenu&&!a.metaKey&&
a.preventDefault()};b.addEventListener("mousemove",this.mousemovelistener);b.addEventListener("mousedown",this.mousedownlistener);b.addEventListener("mouseup",this.mouseuplistener);b.addEventListener("mouseout",this.mouseoutlistener);b.addEventListener("contextmenu",this.contextmenulistener);this.app.on("kill",this.kill.bind(this));this.enableMousewheel();b.requestPointerLock=b.requestPointerLock||b.mozRequestPointerLock||b.webkitRequestPointerLock;document.exitPointerLock=document.exitPointerLock||
document.mozExitPointerLock||document.webkitExitPointerLock;this.handleResize()};
PLAYGROUND.Mouse.prototype={kill:function(){this.element.removeEventListener("mousemove",this.mousemovelistener);this.element.removeEventListener("mousedown",this.mousedownlistener);this.element.removeEventListener("mouseup",this.mouseuplistener);this.element.removeEventListener("mouseout",this.mouseoutlistener);this.element.removeEventListener("contextmenu",this.contextmenulistener)},mouseout:function(a){for(a=0;3>a;a++)this.mouseup({button:a})},lock:function(){this.locked=!0;this.element.requestPointerLock()},
unlock:function(){this.locked=!1;document.exitPointerLock()},getElementOffset:function(a){var b=0,c=0;do b+=a.offsetLeft,c+=a.offsetTop;while(a=a.offsetParent);return{x:b,y:c}},handleResize:function(){this.elementOffset=this.getElementOffset(this.element)},mousemove:PLAYGROUND.Utils.throttle(function(a){this.enabled&&(this.x=this.mousemoveEvent.x=(a.pageX-this.elementOffset.x-this.app.offsetX)/this.app.scale|0,this.y=this.mousemoveEvent.y=(a.pageY-this.elementOffset.y-this.app.offsetY)/this.app.scale|
0,this.mousemoveEvent.original=a,this.locked&&(this.mousemoveEvent.movementX=a.movementX||a.mozMovementX||a.webkitMovementX||0,this.mousemoveEvent.movementY=a.movementY||a.mozMovementY||a.webkitMovementY||0),this.app.mouseToTouch?(this.mousemoveEvent.id=this.mousemoveEvent.identifier=255,this.trigger("touchmove",this.mousemoveEvent)):(this.mousemoveEvent.id=this.mousemoveEvent.identifier=255,this.trigger("mousemove",this.mousemoveEvent)))},15),mousedown:function(a){if(this.enabled){var b=["left",
"middle","right"][a.button];this.mousedownEvent.x=this.mousemoveEvent.x;this.mousedownEvent.y=this.mousemoveEvent.y;this.mousedownEvent.button=b;this.mousedownEvent.original=a;this[b]=!0;this.mousedownEvent.id=this.mousedownEvent.identifier=255;this.app.mouseToTouch?(this.trigger("touchmove",this.mousedownEvent),this.trigger("touchstart",this.mousedownEvent)):this.trigger("mousedown",this.mousedownEvent)}},mouseup:function(a){if(this.enabled){var b=["left","middle","right"][a.button];this[b]&&(this.mouseupEvent.x=
this.mousemoveEvent.x,this.mouseupEvent.y=this.mousemoveEvent.y,this.mouseupEvent.button=b,this.mouseupEvent.original=a,this.mouseupEvent.id=this.mouseupEvent.identifier=255,this.app.mouseToTouch?this.trigger("touchend",this.mouseupEvent):this.trigger("mouseup",this.mouseupEvent),this[b]=!1)}},mousewheel:function(a){this.mousewheelEvent.x=this.mousemoveEvent.x;this.mousewheelEvent.y=this.mousemoveEvent.y;this.mousewheelEvent.button=["none","left","middle","right"][a.button];this.mousewheelEvent.original=
a;this.mousewheelEvent.id=this.mousewheelEvent.identifier=255;this[a.button]=!1;this.trigger("mousewheel",this.mousewheelEvent)},enableMousewheel:function(){var a="onwheel"in document||9<=document.documentMode?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],b=this.mousewheel.bind(this),c=this,e=PLAYGROUND.Utils.throttle(function(a){var d=a||window.event;[].slice.call(arguments,1);var e=0,f=0;d.wheelDelta&&(e=d.wheelDelta);d.detail&&(e=-1*d.detail);d.deltaY&&(e=f=-1*d.deltaY);void 0!==
d.wheelDeltaY&&(f=d.wheelDeltaY);e=e?e:f;c.mousewheelEvent.x=c.mousemoveEvent.x;c.mousewheelEvent.y=c.mousemoveEvent.y;c.mousewheelEvent.delta=e/Math.abs(e);c.mousewheelEvent.original=d;b(c.mousewheelEvent);d.preventDefault()},40),d=a.length;for(;d;)c.element.addEventListener(a[--d],function(a){e(a);a.preventDefault();a.stopPropagation()},!1)}};PLAYGROUND.Utils.extend(PLAYGROUND.Mouse.prototype,PLAYGROUND.Events.prototype);
PLAYGROUND.Sound=function(a){var b=window.AudioContext||window.webkitAudioContext||window.mozAudioContext;b&&!a.forceAudioFallback?(PLAYGROUND.audioContext||(PLAYGROUND.audioContext=new b),a.audioContext=PLAYGROUND.audioContext,a.sound=new PLAYGROUND.SoundWebAudioAPI(a,a.audioContext),a.music=new PLAYGROUND.SoundWebAudioAPI(a,a.audioContext)):(a.sound=new PLAYGROUND.SoundAudio(a),a.music=new PLAYGROUND.SoundAudio(a))};
PLAYGROUND.Application.prototype.playSound=function(a,b){return this.sound.play(a,b)};PLAYGROUND.Application.prototype.stopSound=function(a){this.sound.stop(a)};PLAYGROUND.Application.prototype.loadSound=function(){return this.loadSounds.apply(this,arguments)};PLAYGROUND.Application.prototype.loadSounds=function(){for(var a=0;a<arguments.length;a++){var b=arguments[a];if("object"===typeof b)for(var c in b)this.loadSounds(b[c]);else this.sound.load(b)}};
(function e$jscomp$0(a,b,c){function d(h,f){if(!b[h]){if(!a[h]){var m="function"==typeof require&&require;if(!f&&m)return m(h,!0);if(g)return g(h,!0);f=Error("Cannot find module '"+h+"'");throw f.code="MODULE_NOT_FOUND",f;}f=b[h]={exports:{}};a[h][0].call(f.exports,function(f){var b=a[h][1][f];return d(b?b:f)},f,f.exports,e$jscomp$0,a,b,c)}return b[h].exports}for(var g="function"==typeof require&&require,h=0;h<c.length;h++)d(c[h]);return d})({1:[function(a,b,c){(function(b){b=b.AudioContext||b.webkitAudioContext;
var c=a("stereo-panner-node");b&&!b.prototype.createStereoPanner&&(b.prototype.createStereoPanner=function(){return new c(this)})}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"stereo-panner-node":4}],2:[function(a,b,c){a=new Float32Array(4096);c=new Float32Array(4096);for(var e=0;4096>e;e++)a[e]=Math.cos(e/4096*Math.PI*.5),c[e]=Math.sin(e/4096*Math.PI*.5);b.exports={L:a,R:c}},{}],3:[function(a,b,c){(function(c){function d(a){this.audioContext=
a;this.inlet=a.createChannelSplitter(2);this._pan=a.createGain();this.pan=this._pan.gain;this._wsL=a.createWaveShaper();this._wsR=a.createWaveShaper();this._L=a.createGain();this._R=a.createGain();this.outlet=a.createChannelMerger(2);this.inlet.channelCount=2;this.inlet.channelCountMode="explicit";this._pan.gain.value=0;this._wsL.curve=e.L;this._wsR.curve=e.R;this._L.gain.value=0;this._R.gain.value=0;this.inlet.connect(this._L,0);this.inlet.connect(this._R,1);this._L.connect(this.outlet,0,0);this._R.connect(this.outlet,
0,1);this._pan.connect(this._wsL);this._pan.connect(this._wsR);this._wsL.connect(this._L.gain);this._wsR.connect(this._R.gain);this._isConnected=!1;this._dc1=this._dc1buffer=null}var e=a("./curve");d.prototype.connect=function(a){var b=this.audioContext;this._isConnected||(this._isConnected=!0,this._dc1buffer=b.createBuffer(1,2,b.sampleRate),this._dc1buffer.getChannelData(0).set([1,1]),this._dc1=b.createBufferSource(),this._dc1.buffer=this._dc1buffer,this._dc1.loop=!0,this._dc1.start(b.currentTime),
this._dc1.connect(this._pan));c.AudioNode.prototype.connect.call(this.outlet,a)};d.prototype.disconnect=function(){var a=this.audioContext;this._isConnected&&(this._isConnected=!1,this._dc1.stop(a.currentTime),this._dc1.disconnect(),this._dc1buffer=this._dc1=null);c.AudioNode.prototype.disconnect.call(this.outlet)};b.exports=d}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./curve":2}],4:[function(a,b,c){var e=a("./stereo-panner-impl");
b.exports=function(a){var b=new e(a);Object.defineProperties(b.inlet,{pan:{value:b.pan,enumerable:!0},connect:{value:function(a){return b.connect(a)}},disconnect:{value:function(){return b.disconnect()}}});return b.inlet}},{"./stereo-panner-impl":3}]},{},[1]);
PLAYGROUND.SoundWebAudioAPI=function(a,b){this.app=a;a=(new Audio).canPlayType("audio/mp3");var c=(new Audio).canPlayType('audio/ogg; codecs="vorbis"');this.audioFormat="mp3"===this.app.preferedAudioFormat?a?"mp3":"ogg":c?"ogg":"mp3";this.context=b;this.gainNode=this.context.createGain();this.gainNode.connect(this.context.destination);this.compressor=this.context.createDynamicsCompressor();this.compressor.connect(this.gainNode);this.output=this.compressor;this.gainNode.gain.value=1;this.pool=[];this.volume=
1;this.loops=[];this.app.on("step",this.step.bind(this))};
PLAYGROUND.SoundWebAudioAPI.prototype={buffers:{},aliases:{},alias:function(a,b,c,e){this.aliases[a]={source:b,volume:c,rate:e}},setMaster:function(a){this.volume=a;this.gainNode.gain.value=a},load:function(a){var b=this.app.getAssetEntry(a,"sounds",this.audioFormat),c=this;a=new XMLHttpRequest;a.open("GET",b.url,!0);a.responseType="arraybuffer";this.app.loader.add(b.url);a.onload=function(){c.context.decodeAudioData(this.response,function(a){c.buffers[b.key]=a;c.app.loader.success(b.url)})};a.send()},
cleanArray:function(a,b){for(var c=0,e=a.length;c<e;c++)if(null===a[c]||b&&a[c][b])a.splice(c--,1),e--},getSoundBuffer:function(){if(!this.pool.length)for(var a=0;100>a;a++){var b=[this.context.createBufferSource(),this.context.createGain(),this.context.createStereoPanner()];this.pool.push(b);PLAYGROUND.MOBILE?(b[0].connect(b[1]),b[1].connect(this.gainNode)):(b[0].connect(b[1]),b[1].connect(b[2]),b[2].connect(this.output))}return this.pool.pop()},play:function(a,b){var c=this.aliases[a],e=this.getSoundBuffer();
c&&(a=c.source);bufferSource=e[0];bufferSource.gainNode=e[1];bufferSource.pannerNode=e[2];bufferSource.buffer=this.buffers[a];bufferSource.loop=b||!1;bufferSource.key=a;bufferSource.alias=c;this.setVolume(bufferSource,1);this.setPlaybackRate(bufferSource,1);bufferSource.start(0);bufferSource.volumeLimit=1;return bufferSource},stop:function(a){a&&a.stop(0)},setPlaybackRate:function(a,b){if(a)return a.alias&&(b*=a.alias.rate),a.playbackRate.value=b},getVolume:function(a){if(a)return a.gainNode.gain.value},
setVolume:function(a,b){if(a)return a.alias&&(b*=a.alias.volume),a.gainNode.gain.value=Math.max(0,b)},setPanning:function(a,b){a.pannerNode.pan.value=b},getPanning:function(a){return a.pannerNode.pan.value},fadeOut:function(a){if(a)return a.fadeOut=!0,this.loops.push(a),a},fadeIn:function(a){if(a)return a.fadeIn=!0,this.loops.push(a),this.setVolume(a,0),a},step:function(a){for(var b=0;b<this.loops.length;b++){var c=this.loops[b];if(c.fadeIn){var e=this.getVolume(c);e=this.setVolume(c,Math.min(1,e+
.5*a));1<=e&&this.loops.splice(b--,1)}c.fadeOut&&(e=this.getVolume(c),e=this.setVolume(c,Math.min(1,e-.5*a)),0>=e&&(this.loops.splice(b--,1),this.stop(c)))}}};PLAYGROUND.SoundAudio=function(a){this.app=a;a=(new Audio).canPlayType("audio/mp3");var b=(new Audio).canPlayType('audio/ogg; codecs="vorbis"');this.audioFormat="mp3"===this.app.preferedAudioFormat?a?"mp3":"ogg":b?"ogg":"mp3"};
PLAYGROUND.SoundAudio.prototype={samples:{},setMaster:function(a){this.volume=a},setMasterPosition:function(){},setPosition:function(a,b,c){},load:function(a){console.log(a,this.audioFormat);var b="sounds/"+a+"."+this.audioFormat,c=this.app.loader;this.app.loader.add(b);a=this.samples[a]=new Audio;a.addEventListener("canplay",function(){console.log("CANPLAY");this.pause();c.success(b)});a.addEventListener("error",function(){c.error(b)});a.src=b;a.play()},play:function(a,b){a=this.samples[a];a.currentTime=
0;a.loop=b;a.play();return a},stop:function(a){a&&a.pause()},step:function(a){},setPlaybackRate:function(a,b){},setVolume:function(a,b){a.volume=b*this.volume},setPanning:function(a,b){}};
PLAYGROUND.Touch=function(a,b){PLAYGROUND.Events.call(this);this.app=a;this.element=b;this.touches={};this.enabled=!0;this.y=this.x=0;this.touchmovelistener=this.touchmove.bind(this);this.touchstartlistener=this.touchstart.bind(this);this.touchendlistener=this.touchend.bind(this);b.addEventListener("touchmove",this.touchmovelistener);b.addEventListener("touchstart",this.touchstartlistener);b.addEventListener("touchend",this.touchendlistener);this.app.on("kill",this.kill.bind(this))};
PLAYGROUND.Touch.prototype={kill:function(){this.element.removeEventListener("touchmove",this.touchmovelistener);this.element.removeEventListener("touchstart",this.touchstartlistener);this.element.removeEventListener("touchend",this.touchendlistener)},getElementOffset:function(a){var b=0,c=0;do b+=a.offsetLeft,c+=a.offsetTop;while(a=a.offsetParent);return{x:b,y:c}},handleResize:function(){this.elementOffset=this.getElementOffset(this.element)},touchmove:function(a){if(this.enabled){for(var b=0;b<
a.changedTouches.length;b++){var c=a.changedTouches[b];touchmoveEvent={};this.x=touchmoveEvent.x=(c.pageX-this.elementOffset.x-this.app.offsetX)/this.app.scale|0;this.y=touchmoveEvent.y=(c.pageY-this.elementOffset.y-this.app.offsetY)/this.app.scale|0;touchmoveEvent.original=c;touchmoveEvent.id=touchmoveEvent.identifier=c.identifier;this.touches[c.identifier].x=touchmoveEvent.x;this.touches[c.identifier].y=touchmoveEvent.y;this.trigger("touchmove",touchmoveEvent)}a.preventDefault()}},touchstart:function(a){if(this.enabled){for(var b=
0;b<a.changedTouches.length;b++){var c=a.changedTouches[b],e={};this.x=e.x=(c.pageX-this.elementOffset.x-this.app.offsetX)/this.app.scale|0;this.y=e.y=(c.pageY-this.elementOffset.y-this.app.offsetY)/this.app.scale|0;e.original=a.touch;e.id=e.identifier=c.identifier;this.touches[c.identifier]={x:e.x,y:e.y};this.trigger("touchstart",e)}a.preventDefault()}},touchend:function(a){if(this.enabled){for(var b=0;b<a.changedTouches.length;b++){var c=a.changedTouches[b],e={};e.x=(c.pageX-this.elementOffset.x-
this.app.offsetX)/this.app.scale|0;e.y=(c.pageY-this.elementOffset.y-this.app.offsetY)/this.app.scale|0;e.original=c;e.id=e.identifier=c.identifier;delete this.touches[c.identifier];this.trigger("touchend",e)}a.preventDefault()}}};PLAYGROUND.Utils.extend(PLAYGROUND.Touch.prototype,PLAYGROUND.Events.prototype);PLAYGROUND.Tween=function(a,b){PLAYGROUND.Events.call(this);this.manager=a;this.context=b;PLAYGROUND.Utils.extend(this,{prevEasing:"045",prevDuration:.5});this.clear()};
PLAYGROUND.Tween.prototype={add:function(a,b,c){"undefined"!==typeof b?this.prevDuration=b:b=.5;c?this.prevEasing=c:c="045";this.actions.push([a,b,c]);return this},clear:function(){this.actions=[];this.index=-1;this.current=!1;return this},discard:function(){this.manager.discard(this.context,this);return this},to:function(a,b,c){return this.add(a,b,c)},call:function(a,b){for(var c=["call",a,b||this.context],e=2;e<arguments.length;e++)c.push(arguments[e]);this.actions.push(c);return this},loop:function(){this.looped=
!0;return this},repeat:function(a){this.actions.push(["repeat",a]);return this},wait:function(a){this.actions.push(["wait",a]);return this},delay:function(a){this.actions.push(["wait",a]);return this},stop:function(){this.manager.remove(this);return this},play:function(){this.manager.add(this);this.finished=!1;return this},end:function(){for(var a=0,b=this.index+1;b<this.actions.length;b++)"object"===typeof this.actions[b][0]&&(a=b);this.index=a-1;this.next();this.delta=this.duration;this.step(0);
return this},forward:function(){this.delta=this.duration;this.step(0)},rewind:function(){this.delta=0;this.step(0)},next:function(){this.delta=0;this.index++;if(this.index>=this.actions.length)if(this.looped)this.trigger("loop",{tween:this}),this.index=0;else{this.manager.remove(this);return}this.current=this.actions[this.index];if("call"===this.current[0]){var a=this.current.slice(2),b=this.current[2];b[this.current[1]].apply(b,a)}else if("wait"===this.current[0])this.duration=this.current[1],this.currentAction=
"wait";else{a=this.current[0];this.keys=Object.keys(a);this.change=[];this.before=[];this.types=[];for(b=0;b<this.keys.length;b++){var c=this.keys[b],e=this.context[c];if("number"===typeof a[c])e=e||0,this.before.push(e),this.change.push(a[c]-e),this.types.push(0);else if("string"===typeof a[c]&&-1<a[c].indexOf("rad"))e=e||0,this.before.push(e),this.change.push(PLAYGROUND.Utils.circWrappedDistance(e,parseFloat(a[c]))),this.types.push(2);else{e=e||"#000";e=cq.color(e);this.before.push(e);c=cq.color(a[c]);
for(var d=[],g=0;3>g;g++)d.push(c[g]-e[g]);this.change.push(d);this.types.push(1)}}this.currentAction="animate";this.duration=this.current[1];this.easing=this.current[2]}},prev:function(){},step:function(a){this.delta+=a;this.current||this.next();switch(this.currentAction){case "animate":this.doAnimate(a);break;case "wait":this.doWait(a)}},doAnimate:function(a){this.progress=this.duration?Math.min(1,this.delta/this.duration):1;for(var b=PLAYGROUND.Utils.ease(this.progress,this.easing),c=0;c<this.keys.length;c++){var e=
this.keys[c];switch(this.types[c]){case 0:this.context[e]=this.before[c]+this.change[c]*b;break;case 1:for(var d=this.change[c],g=this.before[c],h=[],n=0;3>n;n++)h.push(g[n]+d[n]*b|0);this.context[e]="rgb("+h.join(",")+")";break;case 2:this.context[e]=PLAYGROUND.Utils.circWrap(this.before[c]+this.change[c]*b)}}1<=this.progress&&this.next();this.listeners.step&&this.trigger("step",{tween:this,dt:a})},doWait:function(a){this.delta>=this.duration&&this.next()},onremove:function(){this.trigger("finished",
{tween:this});this.trigger("finish",{tween:this});this.finished=!0}};PLAYGROUND.Utils.extend(PLAYGROUND.Tween.prototype,PLAYGROUND.Events.prototype);PLAYGROUND.TweenManager=function(a){this.tweens=[];a&&(this.app=a,this.app.tween=this.tween.bind(this));this.delta=0;this.app.on("step",this.step.bind(this))};
PLAYGROUND.TweenManager.prototype={defaultEasing:"128",circ:function(a){return{type:"circ",value:a}},discard:function(a,b){for(var c=0;c<this.tweens.length;c++){var e=this.tweens[c];e.context===a&&e!==b&&this.remove(e)}},tween:function(a){a=new PLAYGROUND.Tween(this,a);this.add(a);return a},step:function(a){this.delta+=a;for(var b=0;b<this.tweens.length;b++){var c=this.tweens[b];c._remove||c.step(a);c._remove&&this.tweens.splice(b--,1)}},add:function(a){a._remove=!1;-1===this.tweens.indexOf(a)&&this.tweens.push(a)},
remove:function(a){a._remove||(a._remove=!0,a.onremove())}};PLAYGROUND.Application.prototype.loadAtlases=function(){for(var a=0;a<arguments.length;a++){var b=arguments[a];if("object"===typeof b)for(var c in b)this.loadAtlases(b[c]);else this._loadAtlas(b)}};PLAYGROUND.Application.prototype.loadAtlas=function(){return this.loadAtlases.apply(this,arguments)};
PLAYGROUND.Application.prototype._loadAtlas=function(a){var b=this.getAssetEntry(a,"atlases","png");this.loader.add(b.url);var c=this.atlases[b.key]={};a=c.image=new Image;a.addEventListener("load",function(){e.success(b.url)});a.addEventListener("error",function(){e.error(b.url)});a.src=b.url;a=new XMLHttpRequest;a.open("GET",b.path+".json",!0);this.loader.add(b.path+".json");var e=this.loader;a.onload=function(){var a=JSON.parse(this.response);c.frames=[];for(var g=0;g<a.frames.length;g++){var h=
a.frames[g];c.frames.push({region:[h.frame.x,h.frame.y,h.frame.w,h.frame.h],offset:[h.spriteSourceSize.x||0,h.spriteSourceSize.y||0],width:h.sourceSize.w,height:h.sourceSize.h})}e.success(b.path+".json")};a.send()};
PLAYGROUND.Application.prototype.loadFontOld=function(a){function b(){var m=cq(32,32);m.font("10px "+a).fillText(16,16,16);m.trim();m.width!==h||m.height!==n?f.loader.ready("font "+a):setTimeout(b,250)}var c=document.createElement("style");c.type="text/css";var e={woff:"woff",ttf:"truetype"},d="",g;for(g in e)d+=' url("fonts/'+a+"."+g+"\") format('"+e[g]+"');";c.textContent="@font-face { font-family: '"+a+"'; src: "+d+" }";document.head.appendChild(c);c=cq(32,32);c.font("10px Testing");c.fillText(16,
16,16).trim();var h=c.width,n=c.height;this.loader.add("font "+a);var f=this;b()};PLAYGROUND.DefaultState={};
PLAYGROUND.LoadingScreen={logoRaw:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAANoAAAASBAMAAADPiN0xAAAAGFBMVEUAAQAtLixHSUdnaGaJioimqKXMzsv7/fr5shgVAAAAAWJLR0QAiAUdSAAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB98EAwkeA4oQWJ4AAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAB9klEQVQ4y72UvW+rMBDAz+FrpVKrrFmesmapWNOlrKjSe1kZ+uoVAvj+/frujG1SaJcqJwU7voOf7xMQzQmsIDi5NPTMsLRntH3U+F6SAZo3NlCvcgBFJz8o+vkDiE63lI95Y/UmpinsZWkgJWJiDbAVQ16htptxSTNloIlugwaw001Ey3ASF3so6L1qLNXzQS5S0UGKL/CI5wWNriE0UH9Yty37LqIVg+wsqu7Ix0MwVBSF/dU+jv2SNnma021LEdPqVnMeU3xAu0kXcSGjmq7Ox4E2Wn88LZ2+EFj3avjixzai6VPVyuYveZLHF2XfdDnvAq27DIHGuq+0DJFsE30OtB1KqOwd8Dr7PcM4b+jfj2g5lp4WyntBK66qua3JzEA+uXJpwH/NlVuzRVPY/kTLB2mjuN+KwdZ8FOy8j2gDbEUSqumnSCY4lf4ibq3IhVM4ycZQRnv+zFqVdJQVn6BxvUqebGpuaNo3sZxwBzjajiMZOoBiwyVF+kCr+nUaJOaGpnAeRPPJZTr4FqmHRXcneEo4DqQ/ftfdnLeDrUAME8xWKPeKCwW6YkEpXfs3p1EWJhdcUAYP0TI/uYaV8cgjwBovaeyWwji2T9rTFIdS/cP/MnkTLRUWxgNNZVin7bT5fqT9miDcUVJzR1gRpfIONMmulU+5Qqr6zXAUqAAAAABJRU5ErkJggg==",create:function(){var a=
this;this.logo=new Image;this.logo.addEventListener("load",function(){a.ready=!0;a.createElements()});this.logo.src=this.logoRaw;this.background="#000";window.getComputedStyle&&(this.background=window.getComputedStyle(document.body).backgroundColor||"#000")},enter:function(){this.current=0},leave:function(){this.locked=!0;this.animation=this.app.tween(this).to({current:1},.5)},step:function(a){this.locked?this.animation.finished&&(this.locked=!1,this.wrapper.parentNode.removeChild(this.wrapper)):
this.current+=Math.abs(this.app.loader.progress-this.current)*a},createElements:function(){this.width=.6*window.innerWidth|0;this.height=.1*window.innerHeight|0;this.wrapper=document.createElement("div");this.wrapper.style.width=this.width+"px";this.wrapper.style.height=this.height+"px";this.wrapper.style.background="#000";this.wrapper.style.border="4px solid #fff";this.wrapper.style.position="absolute";this.wrapper.style.left=(window.innerWidth/2-this.width/2|0)+"px";this.wrapper.style.top=(window.innerHeight/
2-this.height/2|0)+"px";this.wrapper.style.zIndex=100;this.app.container.appendChild(this.wrapper);this.progressBar=document.createElement("div");this.progressBar.style.width="0%";this.progressBar.style.height=this.height+"px";this.progressBar.style.background="#fff";this.wrapper.appendChild(this.progressBar)},render:function(){this.ready&&(this.progressBar.style.width=(100*this.current|0)+"%")}};
(function(){var a=!1,b=window.HTMLCanvasElement,c=window.HTMLImageElement,e=window.ImageBitmap||window.HTMLImageElement;a=navigator.isCocoonJS;var d=function(a){if(0===arguments.length){var f=d.pool();f.width=window.innerWidth;f.height=window.innerHeight}else if("string"===typeof a)f=document.querySelector(a);else if("number"===typeof a)f=d.pool(),f.width=arguments[0],f.height=arguments[1];else if(a instanceof c)f=d.pool(),f.width=a.width,f.height=a.height,f.getContext("2d").drawImage(a,0,0);else if(a instanceof
e)f=d.pool(),f.width=a.width,f.height=a.height,f.getContext("2d").drawImage(a,0,0);else{if(a instanceof d.Layer)return a;f=a}return new d.Layer(f)};d.lineSpacing=1;d.defaultFont="";d.textBaseline="alphabetic";d.matchPalettePrecision=10;d.palettes={db16:"#140c1c #442434 #30346d #4e4a4e #854c30 #346524 #d04648 #757161 #597dce #d27d2c #8595a1 #6daa2c #d2aa99 #6dc2ca #dad45e #deeed6".split(" "),db32:"#000000 #222034 #45283c #663931 #8f563b #df7126 #d9a066 #eec39a #fbf236 #99e550 #6abe30 #37946e #4b692f #524b24 #323c39 #3f3f74 #306082 #5b6ee1 #639bff #5fcde4 #cbdbfc #ffffff #9badb7 #847e87 #696a6a #595652 #76428a #ac3232 #d95763 #d77bba #8f974a #8a6f30".split(" "),
c64:"#000000 #6a5400 #68ae5c #8a8a8a #adadad #636363 #c37b75 #c9d684 #ffffff #984b43 #a3e599 #79c1c8 #9b6739 #9b51a5 #52429d #8a7bce".split(" "),gameboy:["#0f380f","#306230","#8bac0f","#9bbc0f"],sega:"#000000 #555500 #005500 #555555 #55aa00 #550000 #aaffaa #aaaaaa #ff5555 #005555 #550055 #aaaa55 #ffffaa #aa5555 #ffaa55 #ffff55 #ffffff #ffaaaa #000055 #55aaaa #aa0000 #ff5500 #ffaa00 #aa5500 #ff0000 #ffaaff #aa55aa #aaaa00 #aaff00 #aaaaff #5555aa #aaffff".split(" "),cga:["#000000","#ff5555","#55ff55",
"#ffff55"],nes:"#7C7C7C #0000FC #0000BC #4428BC #940084 #A80020 #A81000 #881400 #503000 #007800 #006800 #005800 #004058 #000000 #000000 #000000 #BCBCBC #0078F8 #0058F8 #6844FC #D800CC #E40058 #F83800 #E45C10 #AC7C00 #00B800 #00A800 #00A844 #008888 #000000 #000000 #000000 #F8F8F8 #3CBCFC #6888FC #9878F8 #F878F8 #F85898 #F87858 #FCA044 #F8B800 #B8F818 #58D854 #58F898 #00E8D8 #787878 #000000 #000000 #FCFCFC #A4E4FC #B8B8F8 #D8B8F8 #F8B8F8 #F8A4C0 #F0D0B0 #FCE0A8 #F8D878 #D8F878 #B8F8B8 #B8F8D8 #00FCFC #F8D8F8 #000000".split(" ")};
d.cocoon=function(a){if(0===arguments.length){var f=d.createCocoonCanvas(window.innerWidth,window.innerHeight);window.addEventListener("resize",function(){})}else if("string"===typeof a)f=document.querySelector(a);else if("number"===typeof a)f=d.createCocoonCanvas(arguments[0],arguments[1]);else if(a instanceof c)f=d.createCocoonCanvas(a);else{if(a instanceof d.Layer)return a;f=a}return new d.Layer(f)};d.extend=function(){for(var a=1;a<arguments.length;a++)for(var b in arguments[a])arguments[0][b]=
arguments[a][b];return arguments[0]};d.augment=function(){for(var a=1;a<arguments.length;a++)_.extend(arguments[0],arguments[a]),arguments[a](arguments[0])};d.distance=function(a,b,l,c){if(2<arguments.length){var f=a-l,m=b-c;return Math.sqrt(f*f+m*m)}return Math.abs(a-b)};d.fastApply=function(a,b,l){switch(l.length){case 0:return a.call(b);case 1:return a.call(b,l[0]);case 2:return a.call(b,l[0],l[1]);case 3:return a.call(b,l[0],l[1],l[2]);case 4:return a.call(b,l[0],l[1],l[2],l[3]);case 5:return a.call(b,
l[0],l[1],l[2],l[3],l[4]);case 6:return a.call(b,l[0],l[1],l[2],l[3],l[4],l[5]);case 7:return a.call(b,l[0],l[1],l[2],l[3],l[4],l[5],l[6]);case 8:return a.call(b,l[0],l[1],l[2],l[3],l[4],l[5],l[6],l[7]);case 9:return a.call(b,l[0],l[1],l[2],l[3],l[4],l[5],l[6],l[7],l[8]);default:return a.apply(b,l)}};d.extend(d,{smoothing:!0,blend:function(a,b,l,c){"undefined"===typeof c&&(c=1);a=d(a);var f=a.clone();b=d(b);a.save();a.globalAlpha(c);a.globalCompositeOperation(l);a.drawImage(b.canvas,0,0);a.restore();
f.save();f.globalCompositeOperation("source-in");f.drawImage(a.canvas,0,0);f.restore();return f},matchColor:function(a,b){for(var f=[],m=0;m<b.length;m++)f.push(d.color(b[m]));var c=d.color(a);a=[];for(m=0;m<f.length;m++){var k=f[m];a.push(Math.abs(c[0]-k[0])+Math.abs(c[1]-k[1])+Math.abs(c[2]-k[2]))}for(m=f=0;m<b.length;m++)a[m]<a[f]&&(f=m);return b[f]},temp:function(a,m){this.tempLayer||(this.tempLayer=d(1,1));a instanceof c||a instanceof e?(this.tempLayer.width=a.width,this.tempLayer.height=a.height,
this.tempLayer.context.drawImage(a,0,0)):a instanceof b?(this.tempLayer.width=a.width,this.tempLayer.height=a.height,this.tempLayer.context.drawImage(a,0,0)):a instanceof CanvasQuery.Layer?(this.tempLayer.width=a.width,this.tempLayer.height=a.height,this.tempLayer.context.drawImage(a.canvas,0,0)):(this.tempLayer.width=a,this.tempLayer.height=m);return this.tempLayer},wrapValue:function(a,b,l){return a<b?l+a%l:a>=l?a%l:a},limitValue:function(a,b,l){return a<b?b:a>l?l:a},mix:function(a,b,l){return a+
(b-a)*l},hexToRgb:function(a){return 7===a.length?["0x"+a[1]+a[2]|0,"0x"+a[3]+a[4]|0,"0x"+a[5]+a[6]|0]:["0x"+a[1]+a[1]|0,"0x"+a[2]+a[2]|0,"0x"+a[3]+a[3]|0]},rgbToHex:function(a,b,l){return"#"+(16777216+(a<<16)+(b<<8)+l).toString(16).slice(1,7)},extractCanvas:function(a){return a.canvas?a.canvas:a},compare:function(a,b){a=this.extractCanvas(a);b=this.extractCanvas(b);a=a.getContext("2d").getImageData(0,0,a.width,a.height).data;b=b.getContext("2d").getImageData(0,0,b.width,b.height).data;if(a.length!==
b.length)return!1;for(var f=0;f<a.length;f++)if(a[f]!==b[f])return!1;return!0},rgbToHsl:function(a,b,l){a instanceof Array&&(l=a[2],b=a[1],a=a[0]);a/=255;b/=255;l/=255;var f=Math.max(a,b,l),m=Math.min(a,b,l),c=(f+m)/2;if(f==m)var d=m=0;else{var e=f-m;m=.5<c?e/(2-f-m):e/(f+m);switch(f){case a:d=(b-l)/e+(b<l?6:0);break;case b:d=(l-a)/e+2;break;case l:d=(a-b)/e+4}d/=6}return[d,m,c]},hue2rgb:function(a,b,l){0>l&&(l+=1);1<l&&--l;return l<1/6?a+6*(b-a)*l:.5>l?b:l<2/3?a+(b-a)*(2/3-l)*6:a},hslToRgb:function(a,
b,l){if(0==b)l=b=a=l;else{var f=.5>l?l*(1+b):l+b-l*b,m=2*l-f;l=this.hue2rgb(m,f,a+1/3);b=this.hue2rgb(m,f,a);a=this.hue2rgb(m,f,a-1/3)}return[255*l|0,255*b|0,255*a|0]},rgbToHsv:function(a,b,l){a instanceof Array&&(l=a[2],b=a[1],a=a[0]);a/=255;b/=255;l/=255;var f=Math.max(a,b,l),m=Math.min(a,b,l),c=f-m;if(f==m)var d=0;else{switch(f){case a:d=(b-l)/c+(b<l?6:0);break;case b:d=(l-a)/c+2;break;case l:d=(a-b)/c+4}d/=6}return[d,0==f?0:c/f,f]},hsvToRgb:function(a,b,l){var f=Math.floor(6*a),m=6*a-f;a=l*(1-
b);var c=l*(1-m*b);b=l*(1-(1-m)*b);switch(f%6){case 0:var d=l;var e=b;var g=a;break;case 1:d=c;e=l;g=a;break;case 2:d=a;e=l;g=b;break;case 3:d=a;e=c;g=l;break;case 4:d=b;e=a;g=l;break;case 5:d=l,e=a,g=c}return[255*d,255*e,255*g]},color:function(a,b){var f=new d.Color;f.parse(a,b);return f},poolArray:[],pool:function(){if(!this.poolArray.length)for(var a=0;100>a;a++)this.poolArray.push(this.createCanvas(1,1));return this.poolArray.pop()},reuse:function(a){return this.recycle(a)},recycle:function(a){a instanceof
CanvasQuery.Layer?this.poolArray.push(a.canvas):this.poolArray.push(a)},setContextSmoothing:function(a,b){a.mozImageSmoothingEnabled=b;a.msImageSmoothingEnabled=b;a.webkitImageSmoothingEnabled=b;a.imageSmoothingEnabled=b},createCanvas:function(a,m){var f=document.createElement("canvas");a instanceof c||a instanceof b||a instanceof e?(f.width=a.width,f.height=a.height,f.getContext("2d").drawImage(a,0,0)):(f.width=a,f.height=m);return f},createCocoonCanvas:function(a,b){var f=document.createElement("screencanvas");
a instanceof c?(f.width=a.width,f.height=a.height,f.getContext("2d").drawImage(a,0,0)):(f.width=a,f.height=b);return f},createImageData:function(a,b){return d.createCanvas(a,b).getContext("2d").createImageData(a,b)}});d.Layer=function(a){this.context=a.getContext("2d");this.canvas=a;this.prevAlignX=[];this.prevAlignY=[];this.alignY=this.alignX=0;this.aligned=!1;this.update()};d.Layer.prototype={constructor:d.Layer,update:function(){var b=d.smoothing;"undefined"!==typeof this.smoothing&&(b=this.smoothing);
this.context.mozImageSmoothingEnabled=b;this.context.msImageSmoothingEnabled=b;this.context.webkitImageSmoothingEnabled=b;this.context.imageSmoothingEnabled=b;d.defaultFont&&(this.context.font=d.defaultFont);this.context.textBaseline=d.textBaseline;a&&Cocoon.Utils.setAntialias(b)},appendTo:function(a){("object"===typeof a?a:document.querySelector(a)).appendChild(this.canvas);return this},a:function(a){return arguments.length?(this.previousAlpha=this.globalAlpha(),this.globalAlpha(a)):this.globalAlpha()},
ra:function(){return this.a(this.previousAlpha)},realign:function(){this.alignX=this.prevAlignX[this.prevAlignX.length-1];this.alignY=this.prevAlignY[this.prevAlignY.length-1];return this},align:function(a,b){"undefined"===typeof b&&(b=a);this.alignX=a;this.alignY=b;return this},stars:function(a,b,l,c,d,e,p){"undefined"===typeof l&&(l=.5);"undefined"===typeof c&&(c=.5);"undefined"===typeof d&&(d=0);"undefined"===typeof e&&(e=1);"undefined"===typeof p&&(p=e);this.save();this.translate(a,b);this.align(l,
c);this.rotate(d);this.scale(e,p);return this},tars:function(a,b,l,c,d,e,p){"undefined"===typeof l&&(l=.5);"undefined"===typeof c&&(c=.5);"undefined"===typeof d&&(d=0);"undefined"===typeof e&&(e=1);"undefined"===typeof p&&(p=e);this.translate(a,b);this.align(l,c);this.rotate(d);this.scale(e,p);return this},webkit:"WebkitAppearance"in document.documentElement.style,fillText:function(a,b,l,c){a=String(a);if(a.length){if(!d.smoothing&&64>=this.fontHeight()&&"WebkitAppearance"in document.documentElement.style){var f=
this.webkit?4:5,m=d.pool(),e=m.getContext("2d");e.font=this.context.font;var r=e.measureText(a).width,g=Math.ceil(r);c=c||g-r;r=this.fontHeight();m.width=g*f;m.height=r*f;d.setContextSmoothing(e,!1);e.font=this.context.font;e.fillStyle=this.context.fillStyle;e.textBaseline="top";e.scale(f,f);e.fillText(a,c,-this.fontTop());"center"===this.context.textAlign?b-=.5*g:"right"===this.context.textAlign&&(b-=g);this.drawImage(m,0,0,m.width,m.height,b,l,m.width/f,m.height/f)}else this.context.fillText(a,
b,l-this.fontTop());return this}},fillRect:function(a,b,l,c){this.alignX||this.alignY?this.context.fillRect(a-l*this.alignX|0,b-c*this.alignY|0,l,c):this.context.fillRect(a,b,l,c);return this},strokeRect:function(a,b,l,c){this.alignX||this.alignY?this.context.strokeRect(a-l*this.alignX|0,b-c*this.alignY|0,l,c):this.context.strokeRect(a,b,l,c);return this},drawImage:function(a,b,c,d,e,k,p,q,g){if(this.alignX||this.alignY)null==d?(b-=a.width*this.alignX|0,c-=a.height*this.alignY|0):(k-=q*this.alignX|
0,p-=g*this.alignY|0);null==d?this.context.drawImage(a,b,c):null==k?this.context.drawImage(a,b,c,d,e):this.context.drawImage(a,b,c,d,e,k,p,q,g);return this},drawImageCentered:function(a,b,c,d,e,k,p,q,g){null==d?(b-=.5*a.width|0,c-=.5*a.height|0):(k-=.5*q|0,p-=.5*g|0);null==d?this.context.drawImage(a,b,c):null==k?this.context.drawImage(a,b,c,d,e):this.context.drawImage(a,b,c,d,e,k,p,q,g);return this},save:function(){this.prevAlignX.push(this.alignX);this.prevAlignY.push(this.alignY);this.context.save();
return this},restore:function(){this.realign();this.alignX=this.prevAlignX.pop();this.alignY=this.prevAlignY.pop();this.context.restore();return this},drawTile:function(a,b,c,d,e,k,p,q,g){},checkerboard:function(a,b,c,d,e,k,p){var f=c/e|0,m=d/e|0;this.save();this.rect(a,b,c,d).clip();for(c=0;c<=f;c++)for(d=0;d<=m;d++)this.fillStyle(d%2?c%2?k:p:c%2?p:k),this.fillRect(a+c*e,b+d*e,e,e);this.restore()},drawAtlasFrame:function(a,b,c,d){b=a.frames[b];this.drawRegion(a.image,b.region,c-b.width*this.alignX+
b.offset[0]+b.region[2]*this.alignX,d-b.height*this.alignY+b.offset[1]+b.region[3]*this.alignY);return this},imageFill:function(a,b,c){b=Math.max(b/a.width,c/a.height);this.save();this.scale(b,b);this.drawImage(a,0,0);this.restore()},drawRegion:function(a,b,c,d,e){e=e||1;return this.drawImage(a,b[0],b[1],b[2],b[3],c|0,d|0,b[2]*e|0,b[3]*e|0)},drawRegionCentered:function(a,b,c,d,e){e=e||1;return this.drawImageCentered(a,b[0],b[1],b[2],b[3],c|0,d|0,b[2]*e|0,b[3]*e|0)},cache:function(){return this.clone().canvas},
blendOn:function(a,b,c){d.blend(a,this,b,c);return this},posterize:function(a,b){a=a||32;b=b||4;for(var f=this.getImageData(0,0,this.width,this.height),c=f.data,d=0;d<c.length;d+=b)c[d]-=c[d]%a,c[d+1]-=c[d+1]%a,c[d+2]-=c[d+2]%a;this.putImageData(f,0,0);return this},posterizeAlpha:function(a,b){a=a||32;b=b||4;for(var f=this.getImageData(0,0,this.width,this.height),c=f.data,d=0;d<c.length;d+=b)c[d+3]-=c[d+3]%a;this.putImageData(f,0,0);return this},bw:function(a){a=this.getImageData(0,0,this.width,this.height);
for(var b=a.data,f=0;f<b.length;f+=4){var c=(b[f]+b[f+1]+b[f+2])/3;c=128*(c/128|0);b[f+2]=c/255*b[f]}this.putImageData(a,0,0)},blend:function(a,b,c){if("string"===typeof a){var f=a;a=d(this.canvas.width,this.canvas.height);a.fillStyle(f).fillRect(0,0,this.canvas.width,this.canvas.height)}a=d.blend(this,a,b,c);this.canvas=a.canvas;this.context=a.context;return this},textWithBackground:function(a,b,c,d,e){var f=this.measureText(a).width,l=.8*this.fontHeight(),m=this.fillStyle();e=e||2;this.fillStyle(d).fillRect(b-
2*e,c-e,f+4*e,l+2*e);this.fillStyle(m).textAlign("left").textBaseline("top").fillText(a,b,c);return this},fillCircle:function(a,b,c){this.context.beginPath();this.context.arc(a,b,c,0,2*Math.PI);this.context.fill();return this},strokeCircle:function(a,b,c){this.context.beginPath();this.context.arc(a,b,c,0,2*Math.PI);this.context.stroke();return this},circle:function(a,b,c){this.context.beginPath();this.context.arc(a,b,c,0,2*Math.PI);return this},crop:function(a,b,c,e){1===arguments.length&&(b=arguments[0][1],
c=arguments[0][2],e=arguments[0][3],a=arguments[0][0]);var f=d.createCanvas(c,e);f.getContext("2d").drawImage(this.canvas,a,b,c,e,0,0,c,e);this.canvas.width=c;this.canvas.height=e;d.setContextSmoothing(this.context,!1);this.clear();this.context.drawImage(f,0,0);return this},set:function(a){d.extend(this.context,a)},resize:function(a,b){var f=a,c=b;1===arguments.length?(f=arguments[0]*this.canvas.width|0,c=arguments[0]*this.canvas.height|0):!1===b?this.canvas.width>a?(c=a/this.canvas.width*this.canvas.height|
0,f=a):(f=this.canvas.width,c=this.canvas.height):!1===a&&(this.canvas.width>a?(f=b/this.canvas.height*this.canvas.width|0,c=b):(f=this.canvas.width,c=this.canvas.height));f=d(f,c).drawImage(this.canvas,0,0,this.canvas.width,this.canvas.height,0,0,f,c);this.canvas=f.canvas;this.context=f.context;return this},resizeBounds:function(a,b){a=d(a,b);a.drawImage(this.canvas,0,0);this.canvas=a.canvas;this.context=a.context;return this},imageLine:function(a,b,c,e,t,k,p){b||(b=[0,0,a.width,a.height]);var f=
d.distance(c,e,t,k)/b[3]+.5|0;t=Math.atan2(k-e,t-c)+Math.PI/2;this.save();this.translate(c,e);this.rotate(t);p&&this.scale(p,1);for(c=0;c<=f;c++)this.drawRegion(a,b,-b[2]/2|0,-b[3]*(c+1));this.restore();return this},trim:function(a,b){if(a){a=d.color(a).toArray();var f=!a[3]}else f=!0;for(var c=this.context.getImageData(0,0,this.canvas.width,this.canvas.height).data,m=[this.canvas.width,this.canvas.height,0,0],e=this.canvas.width,p=this.canvas.height,q=0,g=c.length;q<g;q+=4){if(f){if(!c[q+3])continue}else if(c[q+
0]===a[0]&&c[q+1]===a[1]&&c[q+2]===a[2])continue;var h=(q/4|0)%this.canvas.width|0,n=(q/4|0)/this.canvas.width|0;h<m[0]&&(m[0]=h);h>m[2]&&(m[2]=h);n<m[1]&&(m[1]=n);n>m[3]&&(m[3]=n)}if(0!==m[2]||0!==m[3])b&&(b.left=m[0],b.top=m[1],b.bottom=p-m[3],b.right=e-m[2]-m[0],b.width=m[2]-m[0],b.height=m[3]-m[1]),this.crop(m[0],m[1],m[2]-m[0]+1,m[3]-m[1]+1);return this},matchPalette:function(a){a.matches||(a.matches=new Map);if(!a.colors){a.colors=[];for(var b=0;b<a.length;b++)a.colors.push(d.color(a[b]))}var f=
this.context.getImageData(0,0,this.canvas.width,this.canvas.height),c=f.data;for(b=0;b<c.length;b+=4){var e=[];if(c[b+3]){var k=(c[b+0]/d.matchPalettePrecision|0)*d.matchPalettePrecision+(c[b+1]/d.matchPalettePrecision|0)*d.matchPalettePrecision*1E3+(c[b+2]/d.matchPalettePrecision|0)*d.matchPalettePrecision*1E6;if(!a.matches.has(k)){for(var p=0;p<a.colors.length;p++){var q=a.colors[p];e.push(Math.abs(c[b]-q[0])+Math.abs(c[b+1]-q[1])+Math.abs(c[b+2]-q[2]))}for(p=q=0;p<a.length;p++)e[p]<e[q]&&(q=p);
a.matches.set(k,a.colors[q])}e=a.matches.get(k);c[b]=e[0];c[b+1]=e[1];c[b+2]=e[2]}}this.context.putImageData(f,0,0);return this},swapColors:function(a){var b={};for(c in a){var f=d.color(c);f=f[0]+1E3*f[1]+1E6*f[2];b[f]=d.color(a[c])}a=this.context.getImageData(0,0,this.canvas.width,this.canvas.height);var c=a.data;for(var e=0;e<c.length;e+=4)c[e+3]&&(f=c[e]+1E3*c[e+1]+1E6*c[e+2],b[f]&&(c[e]=b[f][0],c[e+1]=b[f][1],c[e+2]=b[f][2]));this.context.putImageData(a,0,0);return this},getPalette:function(){for(var a=
[],b=this.context.getImageData(0,0,this.canvas.width,this.canvas.height).data,c=0,e=b.length;c<e;c+=4)if(b[c+3]){var g=d.rgbToHex(b[c+0],b[c+1],b[c+2]);-1===a.indexOf(g)&&a.push(g)}return a},mapPalette:function(){},polygon:function(a,b,c){void 0===b&&(b=0);void 0===c&&(c=0);this.beginPath();this.moveTo(a[0][0]+b,a[0][1]+c);for(var f=1;f<a.length;f++)this.lineTo(a[f][0]+b,a[f][1]+c);this.closePath();return this},fillPolygon:function(a){this.polygon(a);this.fill()},strokePolygon:function(a){this.polygon(a);
this.stroke()},colorToMask:function(a,b){d.color(a).toArray();a=this.context.getImageData(0,0,this.canvas.width,this.canvas.height).data;for(var f=[],c=0,e=a.length;c<e;c+=4)0<a[c+3]?f.push(b?!1:!0):f.push(b?!0:!1);return f},grayscaleToMask:function(){for(var a=this.context.getImageData(0,0,this.canvas.width,this.canvas.height).data,b=[],c=0,d=a.length;c<d;c+=4)b.push((a[c+0]+a[c+1]+a[c+2])/3/255);return b},applyMask:function(a){for(var b=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),
f=b.data,c=0,d=f.length;c<d;c+=4)f[c+3]=255*a[c/4]|0;this.context.putImageData(b,0,0);return this},fillMask:function(a){var b=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),f=b.data,c="boolean"===typeof a[0]?"bool":"byte",e=2===arguments.length?"normal":"gradient",k=d.color(arguments[1]);"gradient"===e&&(colorB=d.color(arguments[2]));for(var p=0,q=f.length;p<q;p+=4){var g=a[p/4];"byte"===c&&(g/=255);"normal"===e?g&&(f[p+0]=k[0]|0,f[p+1]=k[1]|0,f[p+2]=k[2]|0,f[p+3]=255*g|0):(f[p+
0]=k[0]+(colorB[0]-k[0])*g|0,f[p+1]=k[1]+(colorB[1]-k[1])*g|0,f[p+2]=k[2]+(colorB[2]-k[2])*g|0,f[p+3]=255)}this.context.putImageData(b,0,0);return this},clear:function(a){a?(this.context.fillStyle=a,this.context.fillRect(0,0,this.canvas.width,this.canvas.height)):this.context.clearRect(0,0,this.canvas.width,this.canvas.height);return this},clone:function(){var a=d.pool();a.width=this.width;a.height=this.height;a.getContext("2d").drawImage(this.canvas,0,0);return d(a)},gradientText:function(a,b,c,
d,e){var f=a.split(" "),m=2*this.fontHeight(),l=0;if(d){a=0;for(var g=[""],h=0;h<f.length;h++){var r=f[h]+" ",t=this.context.measureText(r).width;l+t>d&&(g[++a]="",l=0);g[a]+=r;l+=t}}else g=[a];for(h=0;h<g.length;h++){d=c+h*m*.6|0;f=this.context.createLinearGradient(0,d,0,d+.6*m|0);for(l=0;l<e.length;l+=2)f.addColorStop(e[l],e[l+1]);a=g[h];this.fillStyle(f).fillText(a,b,d)}return this},removeColor:function(a){a=d.color(a);for(var b=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),
f=b.data,c=0;c<this.canvas.width;c++)for(var e=0;e<this.canvas.height;e++){var k=4*(e*this.canvas.width+c);f[k+0]===a[0]&&f[k+1]===a[1]&&f[k+2]===a[2]&&(f[k+3]=0)}this.clear();this.context.putImageData(b,0,0);return this},outline:function(){function a(a,f){return 0>a||a>=e.width||0>f||f>=e.height?0:0<b[4*(a+f*e.width)+3]}for(var b=this.context.getImageData(0,0,this.canvas.width,this.canvas.height).data,c=this.createImageData(this.canvas.width,this.canvas.height),d=c.data,e=this.canvas,k=0;k<this.canvas.width;k++)for(var g=
0;g<this.canvas.height;g++){var q=0,h=4*(g*e.width+k);b[h+3]&&(q+=a(k-1,g),q+=a(k+1,g),q+=a(k,g-1),q+=a(k,g+1),4!==q&&(d[h]=255,d[h+1]=255,d[h+2]=255,d[h+3]=255))}this.context.putImageData(c,0,0);return this},setHsl:function(){for(var a=1===arguments.length?arguments[0]:arguments,b=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),c=b.data,e,g,k,p=0,q=c.length;p<q;p+=4)k=d.rgbToHsl(c[p+0],c[p+1],c[p+2]),e=!1===a[0]?k[0]:d.limitValue(a[0],0,1),g=!1===a[1]?k[1]:d.limitValue(a[1],0,
1),k=!1===a[2]?k[2]:d.limitValue(a[2],0,1),e=d.hslToRgb(e,g,k),c[p+0]=e[0],c[p+1]=e[1],c[p+2]=e[2];this.context.putImageData(b,0,0);return this},shiftHsl:function(){for(var a=1===arguments.length?arguments[0]:arguments,b=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),c=b.data,e,g,k,p=0,q=c.length;p<q;p+=4)k=d.rgbToHsl(c[p+0],c[p+1],c[p+2]),c[p+0]!==c[p+1]||c[p+1]!==c[p+2]?(e=!1===a[0]?k[0]:d.wrapValue(k[0]+a[0],0,1),g=!1===a[1]?k[1]:d.limitValue(k[1]+a[1],0,1)):(e=k[0],g=k[1]),
k=!1===a[2]?k[2]:d.limitValue(k[2]+a[2],0,1),e=d.hslToRgb(e,g,k),c[p+0]=e[0],c[p+1]=e[1],c[p+2]=e[2];this.context.putImageData(b,0,0);return this},applyColor:function(b){if(a)return this;this.save();this.globalCompositeOperation("source-in");this.clear(b);this.restore();return this},negative:function(a,b){a=this.context.getImageData(0,0,this.canvas.width,this.canvas.height);b=a.data;for(var c=0,f=b.length;c<f;c+=4)b[c+0]=255-b[c+0],b[c+1]=255-b[c+1],b[c+2]=255-b[c+2];this.context.putImageData(a,0,
0);return this},roundRect:function(a,b,c,d,e){this.beginPath();this.moveTo(a+e,b);this.lineTo(a+c-e,b);this.quadraticCurveTo(a+c,b,a+c,b+e);this.lineTo(a+c,b+d-e);this.quadraticCurveTo(a+c,b+d,a+c-e,b+d);this.lineTo(a+e,b+d);this.quadraticCurveTo(a,b+d,a,b+d-e);this.lineTo(a,b+e);this.quadraticCurveTo(a,b,a+e,b);this.closePath();return this},markupText:function(a){},charWidth:function(a){d.charWidthCache||(d.charWidthCache=new Map);if(!d.charWidthCache.has(this.context.font+a)){var b=this.measureText(a).width;
d.charWidthCache.set(this.context.font+a,b)}return d.charWidthCache.get(this.context.font+a)},pixelText:function(a,b,c){var f=this.context.textAlign;this.context.textAlign="left";var d=0;if("center"===f){for(var e=0;e<a.length;e++){var m=this.charWidth(a[e]),l=m-(m|0);d+=m+(.5<l?1:0)|0}b-=d/2|0}for(e=0;e<a.length;e++)d=a[e],m=this.charWidth(d),l=m-(m|0),this.context.fillText(d,b,c),b+=m+(.5<l?1:0)|0;this.context.textAlign=f;return this},wrappedText:function(a,b,c,d,e){0>d&&(d=0);var f=a.split(" ");
e=e||this.fontHeight();var m=0,l=this.context.textAlign,g=this.context.textBaseline;this.textBaseline("top");var h=this.context.measureText(" ").width|0;!d&&-1<a.indexOf("\n")&&(d=this.textBoundaries(a).width);if(d){a=0;for(var r=[""],t=[0],n=0;n<f.length;n++){var x=f[n],u=Math.ceil(this.context.measureText(x).width);if(d&&u>d){if(5>=x.length)return;u=x.length/2|0;f.splice(n,1);f.splice(n,0,"-"+x.substr(u));f.splice(n,0,x.substr(0,u)+"-");n--}else{if(m+u>d||"\n"===f[n])r[a]=r[a].substr(0,r[a].length-
1),t[a]-=h,r[++a]="",m=t[a]=0;"\n"!==f[n]&&(r[a]+=x+" ",m+=u+h,t[a]+=u+h)}}"\n"!==f[n]&&(r[a]=r[a].substr(0,r[a].length-1),t[a]-=h)}else r=[a],t=[this.context.measureText(a).width];for(n=0;n<r.length;n++)d=c+n*e|0,a=r[n],f=t[n],this.textAlign("left"),"left"===l||"start"===l?this.fillText(a,b,d):"center"===l?this.fillText(a,b-.5*f|0,d):this.fillText(a,b-f,d);this.textAlign(l);this.textBaseline(g);return this},fontHeights:{},fontTops:{},fontTop:function(){this.fontTops[this.context.font]||this.fontHeight();
return this.fontTops[this.context.font]},fontHeight:function(){var a=this.font();if(!this.fontHeights[a]){var b=parseInt(a);b=d(100,10+2*b|0);d.setContextSmoothing(b.context,!1);b.font(a).fillStyle("#fff");b.textBaseline("top");b.context.fillText("Play Moog",20,10);for(var c=b.getImageData(0,0,b.width,b.height).data,e=b.height,g=0,k=0;k<c.length;k+=4){var p=(k/4|0)/b.width|0;200>c[k+3]||(p<e&&(e=p),p>g&&(g=p))}this.fontHeights[a]=g-10+1;this.fontTops[a]=e-10}return this.fontHeights[a]},textBoundaries:function(a,
b){0>b&&(b=0);for(var c=a.split(" "),f=this.fontHeight(),d=0,e=this.context.measureText(" ").width,m=0,g=[""],h=0,n=0;n<c.length;n++){var v=c[n],w=Math.ceil(this.context.measureText(v).width);if(b&&w>b)5>=v.length||(w=v.length/2|0,c.splice(n,1),c.splice(n,0,"-"+v.substr(w)),c.splice(n,0,v.substr(0,w)+"-"),n--);else{if(d+w>b&&b||"\n"===c[n])d>h&&(h=d),g[++m]="",d=0;"\n"!==c[n]&&(g[m]+=v,d+=w+e)}}b?h=b:h||(h=this.context.measureText(a).width);return{height:g.length*f,width:Math.ceil(h),lines:g.length,
fontHeight:f}},repeatImageRegion:function(a,b,c,d,e,k,g,h,n){this.save();this.rect(k,g,h,n);this.clip();var f=0;for(h=Math.ceil(h/d);f<h;f++)for(var m=0,l=Math.ceil(n/e);m<l;m++)this.drawImage(a,b,c,d,e,k+f*d,g+m*e,d,e);this.restore();return this},repeatImage:function(a,b,c,d,e){9>arguments.length?this.repeatImageRegion(a,0,0,a.width,a.height,b,c,d,e):this.repeatImageRegion.apply(this,arguments);return this},borderImageEmptyRegion:[0,0,0,0],borderImage:function(a,b,c,d,e,k,g,h,n,y){if("object"===
typeof k)if(g=k.region,g||(g=this.borderImageEmptyRegion,g[2]=a.width,g[3]=a.height),k.outset)h=k.outset,d>2*h&&e>2*h&&(!1!==k.fill&&this.drawImage(a,g[0]+h,g[1]+h,g[2]-2*h,g[3]-2*h,b+h,c+h,d-2*h,e-2*h),this.drawImage(a,g[0],g[1]+h,h,g[3]-2*h,b,c+h,h,e-2*h),this.drawImage(a,g[0]+g[2]-h,g[1]+h,h,g[3]-2*h,b+d-h,c+h,h,e-2*h),this.drawImage(a,g[0]+h,g[1],g[2]-2*h,h,b+h,c,d-2*h,h),this.drawImage(a,g[0]+h,g[1]+g[3]-h,g[2]-2*h,h,b+h,c+e-h,d-2*h,h),this.drawImage(a,g[0],g[1],h,h,b,c,h,h),this.drawImage(a,
g[0],g[1]+g[3]-h,h,h,b,c+e-h,h,h),this.drawImage(a,g[0]+g[2]-h,g[1],h,h,b+d-h,c,h,h),this.drawImage(a,g[0]+g[2]-h,g[1]+g[3]-h,h,h,b+d-h,c+e-h,h,h));else{g=k.bottomLeft||[0,0,0,0];var f=k.bottomRight||[0,0,0,0];h=k.topLeft||[0,0,0,0];n=k.topRight||[0,0,0,0];y=g[3]+h[3];var m=f[3]+n[3],l=h[2]+n[2];f=g[2]+f[2];k.fillPadding=[0,0,0,0];k.left&&(k.fillPadding[0]=k.left[2]);k.top&&(k.fillPadding[1]=k.top[3]);k.right&&(k.fillPadding[2]=k.right[2]);k.bottom&&(k.fillPadding[3]=k.bottom[3]);k.fill&&this.drawImage(a,
k.fill[0],k.fill[1],k.fill[2],k.fill[3],b+k.fillPadding[0],c+k.fillPadding[1],d-k.fillPadding[2]-k.fillPadding[0],e-k.fillPadding[3]-k.fillPadding[1]);if(k.left)this["stretch"===k.left[4]?"drawImage":"repeatImage"](a,k.left[0],k.left[1],k.left[2],k.left[3],b,c+h[3],k.left[2],e-y);if(k.right)this["stretch"===k.right[4]?"drawImage":"repeatImage"](a,k.right[0],k.right[1],k.right[2],k.right[3],b+d-k.right[2],c+n[3],k.right[2],e-m);if(k.top)this["stretch"===k.top[4]?"drawImage":"repeatImage"](a,k.top[0],
k.top[1],k.top[2],k.top[3],b+h[2],c,d-l,k.top[3]);if(k.bottom)this["stretch"===k.bottom[4]?"drawImage":"repeatImage"](a,k.bottom[0],k.bottom[1],k.bottom[2],k.bottom[3],b+g[2],c+e-k.bottom[3],d-f,k.bottom[3]);k.bottomLeft&&this.drawImage(a,k.bottomLeft[0],k.bottomLeft[1],k.bottomLeft[2],k.bottomLeft[3],b,c+e-k.bottomLeft[3],k.bottomLeft[2],k.bottomLeft[3]);k.topLeft&&this.drawImage(a,k.topLeft[0],k.topLeft[1],k.topLeft[2],k.topLeft[3],b,c,k.topLeft[2],k.topLeft[3]);k.topRight&&this.drawImage(a,k.topRight[0],
k.topRight[1],k.topRight[2],k.topRight[3],b+d-k.topRight[2],c,k.topRight[2],k.topRight[3]);k.bottomRight&&this.drawImage(a,k.bottomRight[0],k.bottomRight[1],k.bottomRight[2],k.bottomRight[3],b+d-k.bottomRight[2],c+e-k.bottomRight[3],k.bottomRight[2],k.bottomRight[3])}else 0<k&&0<d-n-g&&this.drawImage(a,n,0,a.width-n-g,k,b+n,c,d-n-g,k),0<h&&0<d-n-g&&this.drawImage(a,n,a.height-h,a.width-n-g,h,b+n,c+e-h,d-n-g,h),0<n&&0<e-h-k&&this.drawImage(a,0,k,n,a.height-h-k,b,c+k,n,e-h-k),0<g&&0<e-h-k&&this.drawImage(a,
a.width-g,k,g,a.height-h-k,b+d-g,c+k,g,e-h-k),0<n&&0<k&&this.drawImage(a,0,0,n,k,b,c,n,k),0<g&&0<k&&this.drawImage(a,a.width-g,0,g,k,b+d-g,c,g,k),0<g&&0<h&&this.drawImage(a,a.width-g,a.height-h,g,h,b+d-g,c+e-h,g,h),0<n&&0<h&&this.drawImage(a,0,a.height-h,n,h,b,c+e-h,n,h),y&&("string"===typeof y?this.fillStyle(y).fillRect(b+n,c+k,d-n-g,e-k-h):0<d-n-g&&0<e-k-h&&this.drawImage(a,n,k,a.width-g-n,a.height-h-k,b+n,c+k,d-n-g,e-k-h))},setPixel:function(a,b,c){return this.fillStyle(a).fillRect(b,c,1,1)},getPixel:function(a,
b){a=this.context.getImageData(a,b,1,1).data;return d.color([a[0],a[1],a[2],a[3]])},clearRect:function(a,b,c,d){this.context.clearRect(a,b,c,d);return this},fill:function(){this.context.fill();return this},stroke:function(){this.context.stroke();return this},createImageData:function(a,b){this.emptyCanvas||(this.emptyCanvas=d.createCanvas(a,b),this.emptyCanvasContext=this.emptyCanvas.getContext("2d"));this.emptyCanvas.width=a;this.emptyCanvas.height=b;return this.emptyCanvasContext.getImageData(0,
0,a,b)},strokeLine:function(a,b,c,d){this.beginPath();"undefined"===typeof c?(this.moveTo(a.x,a.y),this.lineTo(b.x,b.y)):(this.moveTo(a,b),this.lineTo(c,d));this.stroke();return this},shadowOffset:function(a,b){this.context.shadowOffsetX=a;this.context.shadowOffsetY=b;return this},noLineDash:[],tempLineDash:[2,2],setLineDash:function(a){"number"===typeof a&&(this.tempLineDash[0]=a,this.tempLineDash[1]=a,a=this.tempLineDash);this.context.setLineDash(a?a:this.noLineDash);return this},measureText:function(a){return this.context.measureText(a)},
getLineDash:function(){return this.context.getLineDash()},createRadialGradient:function(a,b,c,d,e,g){return this.context.createRadialGradient(a,b,c,d,e,g)},createLinearGradient:function(a,b,c,d){return this.context.createLinearGradient(a,b,c,d)},createPattern:function(a,b){return this.context.createPattern(a,b)},getImageData:function(a,b,c,d){return this.context.getImageData(a,b,c,d)},writeMeta:function(a){var b=JSON.stringify(a);b=encodeURIComponent(b);a=[];for(var c=0;c<b.length;c++)a.push(b.charCodeAt(c));
a.push(127);b=this.width-1;for(var e=this.height-1,f=[];a.length;){c=a.shift();f.unshift(2*c);if(!a.length)for(c=0;c<3-f.length;c++)f.unshift(254);3===f.length&&(this.fillStyle(d.color(f).toRgb()).fillRect(b,e,1,1),f=[],b--,0>b&&(e--,b=this.width-1))}return this},strokeStyle:function(a){if(null==a)return this.context.strokeStyle;this.context.strokeStyle=a;return this},fillStyle:function(a){if(null==a)return this.context.fillStyle;this.context.fillStyle=a;return this},font:function(a){if(null==a)return this.context.font;
this.context.font=a;return this},filter:function(a){if(a)this.context.filter=a;else return this.context.filter;return this},readMeta:function(){for(var a=[],b=this.width-1,c=this.height-1;;){for(var d=this.getPixel(b,c),e=!1,g=0;3>g;g++)254===d[2-g]?e=!0:a.push(d[2-g]/2|0);if(e)break;b--;if(0>b)break}for(b="";a.length;)b+=String.fromCharCode(a.shift());a=!1;console.log(b);try{a=JSON.parse(decodeURIComponent(b))}catch(p){}return a},get width(){return this.canvas.width},get height(){return this.canvas.height},
set width(a){this.canvas.width=a;this.update();return this.canvas.width},set height(a){this.canvas.height=a;this.update();return this.canvas.height}};for(var g="arc arcTo beginPath bezierCurveTo clip closePath createLinearGradient createRadialGradient createPattern drawFocusRing drawImage fill fillRect fillText getImageData isPointInPath lineTo measureText moveTo putImageData quadraticCurveTo rect restore rotate scale setTransform strokeRect strokeText transform translate setLineDash".split(" "),
h=0;h<g.length;h++){var n=g[h];d.Layer.prototype[n]||(d.Layer.prototype[n]=function(a){return function(){for(var b=Array(arguments.length),c=0;c<b.length;++c)b[c]=arguments[c];d.fastApply(a,this.context,b);return this}}(CanvasRenderingContext2D.prototype[n]))}g="globalAlpha globalCompositeOperation lineCap lineJoin lineWidth miterLimit shadowOffsetX shadowOffsetY shadowBlur shadowColor textAlign textBaseline lineDashOffset".split(" ");for(h=0;h<g.length;h++)n=g[h],d.Layer.prototype[n]||(d.Layer.prototype[n]=
Function("if(arguments.length) { this.context."+n+" = arguments[0]; return this; } else { return this.context."+n+"; }"));d.Color=function(a,b){arguments.length&&this.parse(a,b)};d.Color.prototype={toString:function(){return this.toRgb()},parse:function(a,b){if(a[0]instanceof d.Color)this[0]=a[0][0],this[1]=a[0][1],this[2]=a[0][2],this[3]=a[0][3];else if("string"===typeof a)"#"===a[0]?(a=d.hexToRgb(a),this[0]=a[0],this[1]=a[1],this[2]=a[2],this[3]=1):(b=a.match(/rgb\((.*),(.*),(.*)\)/))?(this[0]=
b[1]|0,this[1]=b[2]|0,this[2]=b[3]|0,this[3]=1):(b=a.match(/rgba\((.*),(.*),(.*)\)/))?(this[0]=b[1]|0,this[1]=b[2]|0,this[2]=b[3]|0,this[3]=b[4]|0):(b=a.match(/hsl\((.*),(.*),(.*)\)/))?this.fromHsl(b[1],b[2],b[3]):(b=a.match(/hsv\((.*),(.*),(.*)\)/))&&this.fromHsv(b[1],b[2],b[3]);else switch(b){case "hsl":case "hsla":this.fromHsl(a[0],a[1],a[2],a[3]);break;case "hsv":case "hsva":this.fromHsv(a[0],a[1],a[2],a[3]);break;default:this[0]=a[0],this[1]=a[1],this[2]=a[2],this[3]="undefined"===typeof a[3]?
1:a[3]}},a:function(a){if(1===arguments.length)this[3]=a;else return this[3];return this},alpha:function(a){if(1===arguments.length)this[3]=a;else return this[3];return this},fromHsl:function(){var a=arguments[0]instanceof Array?arguments[0]:arguments;a=d.hslToRgb(parseFloat(a[0]),parseFloat(a[1]),parseFloat(a[2]));this[0]=a[0];this[1]=a[1];this[2]=a[2];this[3]="undefined"===typeof arguments[3]?1:arguments[3]},fromHsv:function(){var a=arguments[0]instanceof Array?arguments[0]:arguments;a=d.hsvToRgb(parseFloat(a[0]),
parseFloat(a[1]),parseFloat(a[2]));this[0]=a[0];this[1]=a[1];this[2]=a[2];this[3]="undefined"===typeof arguments[3]?1:arguments[3]},toArray:function(){return[this[0],this[1],this[2],this[3]]},toRgb:function(){return"rgb("+this[0]+", "+this[1]+", "+this[2]+")"},toRgba:function(){return"rgba("+this[0]+", "+this[1]+", "+this[2]+", "+this[3]+")"},toHex:function(){return d.rgbToHex(this[0],this[1],this[2])},toHsl:function(){var a=d.rgbToHsl(this[0],this[1],this[2]);a[3]=this[3];return a},toHsv:function(){var a=
d.rgbToHsv(this[0],this[1],this[2]);a[3]=this[3];return a},gradient:function(a,b){d.color(a)},shiftHsl:function(a,b,c){var e=this.toHsl();this[0]!==this[1]||this[1]!==this[2]?(a=!1===a?e[0]:d.wrapValue(e[0]+a,0,1),b=!1===b?e[1]:d.limitValue(e[1]+b,0,1)):(a=e[0],b=e[1]);c=!1===c?e[2]:d.limitValue(e[2]+c,0,1);this.fromHsl(a,b,c);return this},setHsl:function(a,b,c){var e=this.toHsl();a=!1===a?e[0]:d.limitValue(a,0,1);b=!1===b?e[1]:d.limitValue(b,0,1);c=!1===c?e[2]:d.limitValue(c,0,1);this.fromHsl(a,
b,c);return this},mix:function(a,b){a=d.color(a);for(var c=0;4>c;c++)this[c]=d.mix(this[c],a[c],b);return this}};return window.cq=window.CanvasQuery=d})();PLAYGROUND.Renderer=function(a){this.app=a;a.on("create",this.create.bind(this));a.on("resize",this.resize.bind(this));a.on("kill",this.kill.bind(this))};PLAYGROUND.Renderer.plugin=!0;
PLAYGROUND.Renderer.prototype={kill:function(){this.app.layer.canvas.parentNode.removeChild(this.app.layer.canvas)},create:function(a){this.app.layer=cq().appendTo(this.app.container);this.app.customContainer||(this.app.container.style.margin="0px",this.app.container.style.overflow="hidden")},resize:function(a){a=this.app;var b=a.layer;b.width=a.width;b.height=a.height;document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement?(b.canvas.style.transformOrigin=
"center",b.canvas.style.webkitTransformOrigin="center"):(b.canvas.style.transformOrigin="0 0",b.canvas.style.webkitTransformOrigin="0 0");b.canvas.style.transform="translate("+a.offsetX+"px,"+a.offsetY+"px) scale("+a.scale+", "+a.scale+")";b.canvas.style.transformStyle="preserve-3d";b.canvas.style.webkitTransform="translate("+a.offsetX+"px,"+a.offsetY+"px) scale("+a.scale+", "+a.scale+")";b.canvas.style.webkitTransformStyle="preserve-3d";cq.smoothing=this.app.smoothing;b.update();b.canvas.style.imageRendering=
"WebkitAppearance"in document.documentElement.style?this.app.smoothing?"auto":"pixelated":this.app.smoothing?"auto":"-moz-crisp-edges";b.canvas.addEventListener("mousedown",function(){this.focus()})}};
PLAYGROUND.Transitions=function(a){this.app=a;a.on("enterstate",this.enterstate.bind(this));a.on("afterpostrender",this.postrender.bind(this));a.on("step",this.step.bind(this));this.progress=1;this.lifetime=0;a.transition=a.transition?a.transition:"split";a.transitionDuration=a.transitionDuration?a.transitionDuration:.5};PLAYGROUND.Transitions.plugin=!0;
PLAYGROUND.Transitions.prototype={enterstate:function(a){this.app.screenshot=this.screenshot=this.app.layer.cache();a.prev&&(this.progress=this.lifetime=0)},postrender:function(){if(!(1<=this.progress))(0,PLAYGROUND.Transitions[this.app.transition])(this.app,this.progress,this.screenshot)},step:function(a){1<=this.progress||(this.lifetime+=a,this.progress=Math.min(this.lifetime/this.app.transitionDuration,1))}};
PLAYGROUND.Transitions.implode=function(a,b,c){b=a.ease(b,"outCubic");b=1-b;a.layer.save();a.layer.tars(a.center.x,a.center.y,.5,.5,0,.5+.5*b,b);a.layer.drawImage(c,0,0);a.layer.restore()};
PLAYGROUND.Transitions.split=function(a,b,c){b=a.ease(b,"inOutCubic");var e=1-b;a.layer.save();a.layer.a(e).clear("#fff").ra();a.layer.drawImage(c,0,0,a.width,a.height/2|0,0,0,a.width,e*a.height/2|0);a.layer.drawImage(c,0,a.height/2|0,a.width,a.height/2|0,0,a.height/2+b*a.height/2+1|0,a.width,Math.max(1,e*a.height*.5|0));a.layer.restore()};
PLAYGROUND.LoadingScreen={logoRaw:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAANoAAAASBAMAAADPiN0xAAAAGFBMVEUAAQAtLixHSUdnaGaJioimqKXMzsv7/fr5shgVAAAAAWJLR0QAiAUdSAAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB98EAwkeA4oQWJ4AAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAB9klEQVQ4y72UvW+rMBDAz+FrpVKrrFmesmapWNOlrKjSe1kZ+uoVAvj+/frujG1SaJcqJwU7voOf7xMQzQmsIDi5NPTMsLRntH3U+F6SAZo3NlCvcgBFJz8o+vkDiE63lI95Y/UmpinsZWkgJWJiDbAVQ16htptxSTNloIlugwaw001Ey3ASF3so6L1qLNXzQS5S0UGKL/CI5wWNriE0UH9Yty37LqIVg+wsqu7Ix0MwVBSF/dU+jv2SNnma021LEdPqVnMeU3xAu0kXcSGjmq7Ox4E2Wn88LZ2+EFj3avjixzai6VPVyuYveZLHF2XfdDnvAq27DIHGuq+0DJFsE30OtB1KqOwd8Dr7PcM4b+jfj2g5lp4WyntBK66qua3JzEA+uXJpwH/NlVuzRVPY/kTLB2mjuN+KwdZ8FOy8j2gDbEUSqumnSCY4lf4ibq3IhVM4ycZQRnv+zFqVdJQVn6BxvUqebGpuaNo3sZxwBzjajiMZOoBiwyVF+kCr+nUaJOaGpnAeRPPJZTr4FqmHRXcneEo4DqQ/ftfdnLeDrUAME8xWKPeKCwW6YkEpXfs3p1EWJhdcUAYP0TI/uYaV8cgjwBovaeyWwji2T9rTFIdS/cP/MnkTLRUWxgNNZVin7bT5fqT9miDcUVJzR1gRpfIONMmulU+5Qqr6zXAUqAAAAABJRU5ErkJggg==",create:function(){var a=
this;this.logo=new Image;this.logo.addEventListener("load",function(){a.ready=!0});this.logo.src=this.logoRaw},enter:function(){this.current=0},leave:function(){this.locked=!0;this.animation=this.app.tween(this).to({current:1},.5)},step:function(a){this.locked?this.animation.finished&&(this.locked=!1):this.current+=Math.abs(this.app.loader.progress-this.current)*a},ready:function(){},render:function(){if(this.ready){this.app.layer.clear(this.app.background);this.app.layer.fillStyle("#fff");this.app.layer.save();
this.app.layer.align(.5,.5);this.app.layer.globalCompositeOperation("lighter");this.app.layer.drawImage(this.logo,this.app.center.x,this.app.center.y);var a=this.current*this.logo.width;this.app.layer.fillStyle("#fff");this.app.layer.fillRect(this.app.center.x,this.app.center.y+32,a,12);this.app.layer.fillRect(this.app.center.x,this.app.center.y+32,this.logo.width,4);this.app.layer.restore()}}};

// "script/engine/Engine.js"

var ENGINE = { };

// "script/Game.js"

var arisMediaIDs = {

  background: '700889', // jpg

  icon_apple: '700890',
  icon_book: '700891',
  icon_burger: '700892',
  icon_candy: '700893',
  icon_chocolate: '700894',
  icon_cinema: '700895',
  icon_donut: '700896',
  icon_guitar: '700897',
  icon_popcorn: '700898',
  icon_record: '700899',
  icon_sandwich: '700900',
  icon_shake: '700901',

  modal_start: '700902',
  modal_success: '700903',
  modal_toohungry: '700904',
  modal_tostaybusy: '700905',
  modal_youatefood: '700906',

  'walking-v2-0': '700907',
  'walking-v2-1': '700908',
  'walking-v2-2': '700909',
  'walking-v2-3': '700910',
  'walking-v2-4': '700911',
  'walking-v2-5': '700912',
  'walking-v2-6': '700913',
  'walking-v2-7': '700914',
  'walking-v2-8': '700915',
  'walking-v2-9': '700916',
  'walking-v2-10': '700917',
  'walking-v2-11': '700918',
  'walking-v2-12': '700919',
  'walking-v2-13': '700920',
  'walking-v2-14': '700921',
  'walking-v2-15': '700922',
  'walking-v2-16': '700923',
  'walking-v2-17': '700924',
  'walking-v2-18': '700925',
  'walking-v2-19': '700926',
  'walking-v2-20': '700927',
  'walking-v2-21': '700928',
  'walking-v2-22': '700929',
  'walking-v2-23': '700930',

};

function shuffle(a) {
    var j, x, i;
    for (i = a.length; i; i--) {
        j = Math.floor(Math.random() * i);
        x = a[i - 1];
        a[i - 1] = a[j];
        a[j] = x;
    }
}

var food = ['apple', 'burger', 'candy', 'chocolate', 'donut', 'popcorn', 'sandwich', 'shake'];
var distractions = ['book', 'cinema', 'guitar', 'record'];

ENGINE.Game = {

  create: function() {
    this.started = false;
    this.result = null;
    this.warning = false;
    this.warned = false;
    this.elapsed = 0;
    this.gametime = 0;
    this.hunger = 0;
    this.buttons = [];
    this.icons = [];
    var foodChain = 0;
    var distractionChain = 0;
    for (var i = 0; i < 140; i++) {
      if ((Math.random() < (80 / (i + 150)) && distractionChain < 3) || foodChain > 5) {
        this.icons.push(distractions[Math.floor(Math.random() * distractions.length)]);
        foodChain = 0;
        distractionChain++;
      } else {
        this.icons.push(food[Math.floor(Math.random() * food.length)]);
        foodChain++;
        distractionChain = 0;
      }
    }
  },

  step: function(dt) {
    if (this.started && !this.result && !this.warning) {
      this.elapsed += dt;
      this.gametime += dt / 45;
      this.hunger += dt / 14;

      if (this.gametime >= 1) {
        this.result = 'success';
      }

      if (this.hunger >= 1) {
        this.result = 'toohungry';
      }
    }
  },

  pointerdown: function(event) {
    var app = this.app;
    var self = this;
    this.buttons.forEach(function(button){
      if (button.minX <= event.x && event.x <= button.maxX && button.minY <= event.y && event.y <= button.maxY) {
        button.fn.bind(self)();
      }
    });
  },

  drawModal: function(modal, size, fn) {
    var app = this.app;
    var layer = this.app.layer;

    layer
      .fillStyle('rgba(50,50,50,0.7)')
      .fillRect(0, 0, app.width, app.height);

    var heightFrac = size === 'large' ? 0.7 : 0.2;

    var modalHeight = Math.min(app.height * heightFrac, (app.width * 0.95) / modal.width * modal.height);
    var modalWidth = modalHeight / modal.height * modal.width;

    layer.drawImage(modal,
      (app.width - modalWidth) / 2, // x
      (app.height - modalHeight) / 2, // y
      modalWidth,
      modalHeight,
    );

    return [{
      minX: 0,
      maxX: app.width,
      minY: 0,
      maxY: app.height,
      fn: fn.bind(this),
    }];
  },

  render: function() {
    var app = this.app;
    var layer = this.app.layer;
    var scaling = app.height / 600;

    layer.clear("#222");

    var backgroundWidth = app.images[arisMediaIDs.background].width * (app.height / app.images[arisMediaIDs.background].height);
    var backgroundOffset = -1 * this.gametime * (backgroundWidth - app.width);
    layer.drawImage(app.images[arisMediaIDs.background], backgroundOffset, 0, backgroundWidth, app.height);

    var iconButtons = [];
    var iconX = backgroundOffset * 2.3 + 20 * scaling;
    this.icons.forEach(function(icon, i){
      if (iconX > app.width) return;
      var iconWidth = app.height * 0.15;
      if (icon !== null) {
        var img = app.images[arisMediaIDs['icon_' + icon]];
        var iconHeight = img.height * (iconWidth / img.width);
        var iconY = app.height * 0.25 - iconHeight / 2;
        layer.drawImage(img, iconX, iconY, iconWidth, iconHeight);
        iconButtons.push({
          minX: iconX,
          maxX: iconX + iconWidth,
          minY: iconY,
          maxY: iconY + iconHeight,
          fn: function(){
            this.icons[i] = null;
            if (distractions.indexOf(icon) !== -1) {
              this.hunger -= 0.08;
            } else {
              this.hunger -= 0.16;
              if (this.warned) {
                this.result = 'youatefood';
              } else {
                this.warning = true;
                this.warned = true;
              }
            }
            if (this.hunger < 0) this.hunger = 0;
          },
        });
      }
      iconX += iconWidth + 40 * scaling;
    });

    var walkImage = app.images[arisMediaIDs['walking-v2-' + (Math.floor(this.elapsed * 18) % 24)]];
    var walkHeight = app.height * 0.4;
    var walkWidth = walkImage.width * (walkHeight / walkImage.height);
    layer.drawImage(walkImage, this.gametime * (app.width - walkWidth), app.height - walkHeight, walkWidth, walkHeight);

    layer.font(Math.floor(20 * scaling) + 'px sans-serif');
    layer.textAlign('left');
    layer
      .fillStyle('black')
      .fillText('Hunger Level', 20, 30 * scaling);
    layer
      .fillStyle('#999')
      .fillRect(20, 45 * scaling, app.width - 40, 30 * scaling);
    layer
      .fillStyle('#b22')
      .fillRect(20, 45 * scaling, (app.width - 40) * this.hunger, 30 * scaling);

    if (!this.started) {
      this.buttons = this.drawModal(app.images[arisMediaIDs.modal_start], 'small', function(){
        this.started = true;
      });
    } else if (this.warning) {
      this.buttons = this.drawModal(app.images[arisMediaIDs.modal_tostaybusy], 'large', function(){
        this.warning = false;
      });
    } else if (this.result === 'success') {
      this.buttons = this.drawModal(app.images[arisMediaIDs.modal_success], 'large', function(){
        ARIS.exitToDialog(98424);
      });
    } else if (this.result === 'youatefood') {
      this.buttons = this.drawModal(app.images[arisMediaIDs.modal_youatefood], 'large', function(){
        ARIS.exitToDialog(98426);
      });
    } else if (this.result === 'toohungry') {
      this.buttons = this.drawModal(app.images[arisMediaIDs.modal_toohungry], 'large', function(){
        ARIS.exitToDialog(98426);
      });
    } else {
      this.buttons = iconButtons;
    }
  }

};

// "script/Main.js"

var ARIS = {};

var app = new PLAYGROUND.Application({

  smoothing: true,

  paths: {
    base: '',
    sounds: 'arismedia://',
    // fonts: 'arismedia://',
    images: 'arismedia://',
    // atlases: 'arismedia://',
    // data: 'arismedia://',
  },

  create: function() {

    /* things to preload */

    for (var i = 0; i < 24; i++) {
        this.loadImage(arisMediaIDs['walking-v2-' + i]);
    }

    this.loadImage(arisMediaIDs['background']);

    this.loadImage(arisMediaIDs['icon_apple']);
    this.loadImage(arisMediaIDs['icon_book']);
    this.loadImage(arisMediaIDs['icon_burger']);
    this.loadImage(arisMediaIDs['icon_candy']);
    this.loadImage(arisMediaIDs['icon_chocolate']);
    this.loadImage(arisMediaIDs['icon_cinema']);
    this.loadImage(arisMediaIDs['icon_donut']);
    this.loadImage(arisMediaIDs['icon_guitar']);
    this.loadImage(arisMediaIDs['icon_popcorn']);
    this.loadImage(arisMediaIDs['icon_record']);
    this.loadImage(arisMediaIDs['icon_sandwich']);
    this.loadImage(arisMediaIDs['icon_shake']);

    this.loadImage(arisMediaIDs['modal_start']);
    this.loadImage(arisMediaIDs['modal_tostaybusy']);
    this.loadImage(arisMediaIDs['modal_success']);
    this.loadImage(arisMediaIDs['modal_toohungry']);
    this.loadImage(arisMediaIDs['modal_youatefood']);

  },

  ready: function() {

    /* after preloading route events to the game state */

    this.setState(ENGINE.Game);

  }

});

</script>

</body>

</html>
